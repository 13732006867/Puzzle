/*
* grrd's Puzzle
* Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
* Licensed under the MPL License
*/
!function(){"use strict";function a(a,b){var c,d=document.createElement("canvas");d.width=1,d.height=b;var e=d.getContext("2d");e.drawImage(a,0,0);for(var f=e.getImageData(0,0,1,b).data,g=0,h=b,i=b;i>g;)c=f[4*(i-1)+3],0===c?h=i:g=i,i=h+g>>1;var j=i/b;return 0===j?1:j}function b(a){var b,c,d,e;if(pa&&(b=new Kinetic.Image({x:0,y:0,width:I,height:J,Image:a,opacity:.1}),aa.add(b),aa.draw()),oa)for(c=0;ga>c;c+=1)for(d=0;ha>d;d+=1)e=new Kinetic.Rect({x:d*W,y:c*X,width:W,height:X,stroke:"#333333",strokeWidth:2}),aa.add(e);ba.add(aa),aa.moveToBottom()}function c(){la=!0,ka=!1}function d(){var a,b;$.mobile.hidePageLoadingMsg(),$.mobile.changePage("#game",{transition:"slide"}),setTimeout(function(){var d=_.getChildren();for(b=0;b<d.length;b+=1)d[b].setZIndex(Math.floor(Math.random()*ha*ga));for(b=0;b<d.length;b+=1)ma?(a=new Kinetic.Tween({node:d[b],x:Math.floor(Math.random()*W*(ha-1))+W/2,y:Math.floor(Math.random()*X*(ga-1))+X/2,rotation:.5*Math.PI*Math.floor(4*Math.random()),duration:1,onFinish:c()}),a.play()):(a=new Kinetic.Tween({node:d[b],x:Math.floor(Math.random()*W*(ha-1))+W/2,y:Math.floor(Math.random()*X*(ga-1))+X/2,duration:1,onFinish:c()}),a.play())},2e3)}function e(a,b,c,d){!function(){var e;if(na){var f=new Kinetic.Shape({drawFunc:function(d){d.beginPath(),d.moveTo(U,V),0===b?d.lineTo(U+W,V):(d.bezierCurveTo(U+.8*W,V+.1*X*c,U,V-.25*X*c,U+W/2,V-.25*X*c),d.bezierCurveTo(U+W,V-.25*X*c,U+.2*W,V+.1*X*c,U+W,V)),a===ha-1?d.lineTo(U+W,V+X):(d.bezierCurveTo(U+W+.1*W*c,V+.8*X,U+W-.25*W*c,V,U+W-.25*W*c,V+X/2),d.bezierCurveTo(U+W-.25*W*c,V+X,U+W+.1*W*c,V+.2*X,U+W,V+X)),b===ga-1?d.lineTo(U,V+X):(d.bezierCurveTo(U+.2*W,V+X-.1*X*c,U+W,V+X+.25*X*c,U+W/2,V+X+.25*X*c),d.bezierCurveTo(U,V+X+.25*X*c,U+.8*W,V+X-.1*X*c,U,V+X)),0===a?d.lineTo(U,V):(d.bezierCurveTo(U-.1*W*c,V+.2*X,U+.25*W*c,V+X,U+.25*W*c,V+X/2),d.bezierCurveTo(U+.25*W*c,V,U-.1*W*c,V+.8*X,U,V)),d.closePath(),d.fillStrokeShape(this)},fillPatternImage:d,fillPatternOffset:[a*W,b*X],stroke:"black",strokeWidth:4});f.toImage({width:W+.6*W,height:X+.6*X,x:.3*-W,y:.3*-X,callback:function(c){e=new Kinetic.Image({image:c,x:a*W+W/2,origX:a*W+W/2,y:b*X+X/2,origY:b*X+X/2,row:b,col:a,offset:[W/2+.3*W,X/2+.3*X],draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>I&&(c=I),0>b&&(b=0),b>J&&(b=J),{x:c,y:b}},name:"part_z"+b+"_s"+a}),s(e),e.createImageHitRegion(function(){_.drawHit()})}}),f.setStrokeWidth(null),f.setStroke(null),f.toImage({width:W+.6*W,height:X+.6*X,x:.3*-W,y:.3*-X,callback:function(c){Q[b][a]=c}})}else e=new Kinetic.Image({x:a*W+W/2,origX:a*W+W/2,y:b*X+X/2,origY:b*X+X/2,row:b,col:a,width:W,height:X,offset:[W/2,X/2],crop:{x:d.width/ha*a,y:d.height/ga*b,width:d.width/ha,height:d.height/ga},stroke:"black",strokeWidth:4,fill:"black",Image:d,draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>I&&(c=I),0>b&&(b=0),b>J&&(b=J),{x:c,y:b}},name:"part_z"+b+"_s"+a}),s(e)}()}function f(){var c,f;for(Q=[],c=0;ga>c;c+=1)Q[c]=[];ja=0,_.removeChildren(),aa.removeChildren(),ba.removeChildren(),ba.setWidth(I),ba.setHeight(J),U=0,V=0,W=I/ha,X=J/ga,Na=1,ba.add(_);var g=I,h=J;if(ca){var i=a(ea,ea.naturalHeight);h/=i}0!==Y.getPos()||5!==F&&6!==F&&7!==F&&8!==F||(g=J,h=I);var j=new Kinetic.Image({width:g,height:h,crop:{x:0,y:0,width:ea.width,height:ea.height},Image:ea});0!==Y.getPos()||5!==F&&6!==F||(j.setRotationDeg(90),j.setX(I)),0!==Y.getPos()||3!==F&&4!==F||(j.setRotationDeg(180),j.setX(I),j.setY(J)),0!==Y.getPos()||7!==F&&8!==F||(j.setRotationDeg(270),j.setY(J)),j.toImage({width:I,height:J,callback:function(a){if((oa||pa)&&b(a),na)j.toImage({width:I,height:J,callback:function(a){for(f=0;ga>f;f+=1)for(c=0;ha>c;c+=1)Na=f%2!==0&&c%2!==0||f%2===0&&c%2===0?1:-1,e(c,f,Na,a);_.draw(),d()}});else{for(f=0;ga>f;f+=1)for(c=0;ha>c;c+=1)Na=f%2!==0&&c%2!==0||f%2===0&&c%2===0?1:-1,e(c,f,Na,a);_.draw(),d()}}})}function g(){return S=Y.getPos(),R=$("input:radio[name=image-set-"+S+"]:checked").val(),ka?void 0:void 0===R?void $("#popup_choose").popup("open"):void 0===C&&0===S?void $("#popup_choose").popup("open"):void(sa&&$("#image"+S+"-"+R).hasClass("locked")||(ka=!0,$.mobile.showPageLoadingMsg("a",document.webL10n.get("lb_load"),!1),oa="on"===wa.val(),pa="on"===xa.val(),ma="on"===ya.val(),qa="on"===za.val(),Oa&&(localStorage.setItem("s_back_g_grid",wa.val()),localStorage.setItem("s_backg_image",xa.val()),localStorage.setItem("s_rotate",ya.val()),localStorage.setItem("s_sound",za.val())),document.getElementById("container").width=G,document.getElementById("container").height=H,J=H-4,I=G,L=fa,0!==S?(E=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,D=Math.min(H,G)*E<=270?"s":Math.min(H,G)*E>1080?"l":"",B="Images/"+z+"/image-set-"+S+"/sujet"+fa+R+D+".jpg"):B=C,$("#g_imageObj").one("load",function(){ea=document.getElementById("g_imageObj"),f()}).attr("src",B).each(function(){navigator.sayswho.indexOf("MSIE")>=0&&this.complete&&$(this).trigger("load")})))}function h(){T="1",H>G?ra?(ga=9,ha=6):(ga=3,ha=2):ra?(ga=6,ha=9):(ga=2,ha=3),g()}function i(){T="2",H>G?ra?(ga=12,ha=8):(ga=6,ha=4):ra?(ga=8,ha=12):(ga=4,ha=6),g()}function j(){T="3",H>G?ra?(ga=18,ha=12):(ga=8,ha=5):ra?(ga=12,ha=18):(ga=5,ha=8),g()}function k(a,b,c,d){var e,f,g,h,i,j,k;if("g_layer"===a.getParent().attrs.name)if("g_layer"===b.getParent().attrs.name){b.setX(c),b.setY(d);var l=new Kinetic.Group({draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>I&&(c=I),0>b&&(b=0),b>J&&(b=J),{x:c,y:b}}});a.moveTo(l),b.moveTo(l),a.setDraggable(!1),b.setDraggable(!1),_.add(l)}else h=a.getX(),i=a.getY(),b.getParent().setX(b.getParent().getX()+c-b.getAbsolutePosition().x),b.getParent().setY(b.getParent().getY()+d-b.getAbsolutePosition().y),a.moveTo(b.getParent()),a.setRotationDeg(b.getRotationDeg()),j=h-a.getAbsolutePosition().x,k=i-a.getAbsolutePosition().y,0===a.getParent().getRotationDeg()&&(a.setX(a.getX()+j),a.setY(a.getY()+k)),90===a.getParent().getRotationDeg()&&(a.setY(a.getY()-j),a.setX(a.getX()+k)),180===a.getParent().getRotationDeg()&&(a.setX(a.getX()-j),a.setY(a.getY()-k)),270===a.getParent().getRotationDeg()&&(a.setY(a.getY()+j),a.setX(a.getX()-k)),a.setDraggable(!1);else if("g_layer"===b.getParent().attrs.name)b.moveTo(a.getParent()),b.setAbsolutePosition(c,d),b.setRotationDeg(a.getRotationDeg()),b.setDraggable(!1);else{f=b.getParent().getChildren();for(var m=c-b.getAbsolutePosition().x,n=d-b.getAbsolutePosition().y;f.length>0;)void 0!==f[0]&&(g=f[0],h=g.getAbsolutePosition().x,i=g.getAbsolutePosition().y,g.moveTo(a.getParent()),g.setRotationDeg(a.getRotationDeg()),j=h-g.getAbsolutePosition().x+m,k=i-g.getAbsolutePosition().y+n,0===a.getParent().getRotationDeg()&&(g.setX(g.getX()+j),g.setY(g.getY()+k)),90===a.getParent().getRotationDeg()&&(g.setY(g.getY()-j),g.setX(g.getX()+k)),180===a.getParent().getRotationDeg()&&(g.setX(g.getX()-j),g.setY(g.getY()-k)),270===a.getParent().getRotationDeg()&&(g.setY(g.getY()+j),g.setX(g.getX()-k)))}f=a.getParent().getChildren();var o=f[0].getAbsolutePosition().x,p=f[0].getAbsolutePosition().x,q=f[0].getAbsolutePosition().y,r=f[0].getAbsolutePosition().y;for(e=0;e<f.length;e+=1)f[e].getAbsolutePosition().x<o&&(o=f[e].getAbsolutePosition().x),f[e].getAbsolutePosition().x>p&&(p=f[e].getAbsolutePosition().x),f[e].getAbsolutePosition().y<q&&(q=f[e].getAbsolutePosition().y),f[e].getAbsolutePosition().y>r&&(r=f[e].getAbsolutePosition().y);h=a.getAbsolutePosition().x,i=a.getAbsolutePosition().y,a.getParent().setOffset(0,0),a.getParent().setX((o+p)/2),a.getParent().setY((q+r)/2),j=h-a.getAbsolutePosition().x,k=i-a.getAbsolutePosition().y,0===a.getParent().getRotationDeg()&&a.getParent().setOffset(-1*j,-1*k),90===a.getParent().getRotationDeg()&&a.getParent().setOffset(-1*k,j),180===a.getParent().getRotationDeg()&&a.getParent().setOffset(j,k),270===a.getParent().getRotationDeg()&&a.getParent().setOffset(k,-1*j),"g_layer"===b.getParent().attrs.name?b.moveToTop():b.getParent().moveToTop(),_.draw(),qa&&document.getElementById("click_sound").play()}function l(a){var b,c,d,e,f=[-1,1,0,0],g=[0,0,-1,1];for(N="g_layer"===a.getParent().attrs.name?a.getRotationDeg():(a.getRotationDeg()+a.getParent().getRotationDeg())%360,b=0;b<f.length;b+=1)e=ba.get(".part_z"+(a.attrs.row+g[b])+"_s"+(a.attrs.col+f[b])),e.length>0&&(O="g_layer"===e[0].getParent().attrs.name?e[0].getRotationDeg():(e[0].getRotationDeg()+e[0].getParent().getRotationDeg())%360,0===N&&(c=a.getAbsolutePosition().x+W*f[b],d=a.getAbsolutePosition().y+X*g[b]),90===N&&(c=a.getAbsolutePosition().x-X*g[b],d=a.getAbsolutePosition().y+W*f[b]),180===N&&(c=a.getAbsolutePosition().x-W*f[b],d=a.getAbsolutePosition().y-X*g[b]),270===N&&(c=a.getAbsolutePosition().x+X*g[b],d=a.getAbsolutePosition().y-W*f[b]),Math.abs(c-e[0].getAbsolutePosition().x)<ia&&Math.abs(d-e[0].getAbsolutePosition().y)<ia&&N===O&&("g_layer"===a.getParent().attrs.name||"g_layer"===e[0].getParent().attrs.name||a.getParent()!==e[0].getParent())&&k(a,e[0],c,d))}function m(a){void 0!==a&&(a.setX(a.attrs.origX),a.setY(a.attrs.origY),a.setRotationDeg(0),a.moveToBottom(),a.setStrokeWidth(null),a.setStroke(null),a.setDraggable(!1),na&&a.setImage(Q[a.attrs.row][a.attrs.col]),_.draw(),na&&a.disableShadow(),qa&&document.getElementById("click_sound").play(),document.body.style.cursor="default",setTimeout(function(){ja+=1,ja===ha*ga&&(Ja.css("display","none"),qa&&document.getElementById("ding_sound").play())},500))}function n(a){var b,c,d;if(N="g_layer"===a.getParent().attrs.name?a.getRotationDeg():(a.getRotationDeg()+a.getParent().getRotationDeg())%360,Math.abs(a.getAbsolutePosition().x-a.attrs.origX)<ia&&Math.abs(a.getAbsolutePosition().y-a.attrs.origY)<ia&&0===N)if("g_layer"===a.getParent().attrs.name)m(a);else for(c=a.getParent().getChildren();c.length>0;)d=c[0],d.moveTo(_),m(d);else if("g_layer"===a.getParent().attrs.name)l(a);else for(c=a.getParent().getChildren(),b=0;b<c.length;b+=1)l(c[b])}function o(a){Ba.val(a).slider("refresh"),Oa&&localStorage.setItem("s_gold",Ba.val()),"on"===Ba.val()?(ra=!0,$("#img_easy").attr("src","Images/easy_gold.png"),$("#img_med").attr("src","Images/medium_gold.png"),$("#img_hard").attr("src","Images/hard_gold.png")):(ra=!1,$("#img_easy").attr("src","Images/easy.png"),$("#img_med").attr("src","Images/medium.png"),$("#img_hard").attr("src","Images/hard.png"))}function p(){var a,b,c,d,e=0;for(a=1;5>a;a+=1)for(b=1;4>b;b+=1)c=Oa?localStorage.getItem(z+a+fa+b)||0:0,e+=parseInt(c),sa?c>0?(d=$("#medal"+a+"-"+b),d.removeClass("dn"),d.attr("src","Images/medal"+c+".svg"),3>b&&($("#image"+a+"-"+(b+1)).removeClass("locked"),$("#lock"+a+"-"+(b+1)).addClass("dn"))):($("#medal"+a+"-"+b).addClass("dn"),3>b&&($("#image"+a+"-"+(b+1)).addClass("locked"),$("#lock"+a+"-"+(b+1)).removeClass("dn"))):($("#medal"+a+"-"+b).addClass("dn"),$("#image"+a+"-"+(b+1)).removeClass("locked"),$("#lock"+a+"-"+(b+1)).addClass("dn"));36===e?(Ca.show(),o("on"),Ba.slider({theme:"d"}).slider("refresh"),Da.hide()):(Da.show(),o("off"),Ba.slider({theme:"d"}).slider("refresh"),Ca.hide())}function q(){var a,b;if(H=$(window).height(),G=$(window).width(),fa="",H>G?(fa="p",$("#img_title").attr("style","width:100%;"),$(".image0").attr("style","height:"+1.5*(G/3-50)+"px;"),$(".lock").css({left:"10%",bottom:(G-70)/9.8,width:"80%"})):($("#img_title").attr("style","max-height:"+H/5+"px;"),$(".image0").attr("style","height:"+(G/3-50)/1.5+"px;"),$(".lock").css({left:"25%",bottom:(G-70)/30,width:"50%"})),La.css("max-height",H-10+"px"),Ma.css("max-width",G-10+"px"),Ga.attr("style","width:"+(G/3-12)+"px;"),Ha.attr("style","width:"+(G/3-12)+"px;"),Ia.attr("style","width:"+(G/3-12)+"px;"),navigator.onLine){for(a=1;5>a;a+=1)for(b=1;4>b;b+=1)$("#radio"+a+"-"+b).attr("style","width:"+(G/3-12)+"px;"),$("#image"+a+"-"+b).attr("src","Images/"+z+"/image-set-"+a+"/sujet"+fa+b+"s.jpg");$(".offline").hide(),$(".online").show()}else $(".offline").show(),$(".online").hide(),Y.slide(0,0);(z!==A||fa!==K)&&(A=z,K=fa,p())}function r(a){var b;Ja.css("display","inline"),a&&(b=Oa?localStorage.getItem(z+S+L+R)||0:0,parseInt(T)>parseInt(b)&&(Oa&&localStorage.setItem(z+S+L+R,T),p(),qa&&document.getElementById("ding_sound").play())),$.mobile.changePage("#title",{transition:"slide",reverse:!0}),q(),setTimeout(function(){q()},500)}function s(a){var b,c;a.on("mouseover",function(){(a.getDraggable()||a.getParent().getDraggable())&&la&&(document.body.style.cursor="pointer")}),a.on("click tap",function(){ua!==!1&&((a.getDraggable()||a.getParent().getDraggable())&&la&&ma&&M===_.getChildren().length-1?"g_layer"===a.getParent().attrs.name?(b=a.getRotation(),la=!1,c=new Kinetic.Tween({node:a,duration:.5,rotation:b+Math.PI/2,onFinish:function(){la=!0,360===a.getRotationDeg()&&a.setRotationDeg(0),a.fire("dragend")}}),c.play()):(b=a.getParent().getRotation(),la=!1,c=new Kinetic.Tween({node:a.getParent(),duration:.5,rotation:b+Math.PI/2,onFinish:function(){la=!0,360===a.getParent().getRotationDeg()&&a.getParent().setRotationDeg(0),a.fire("dragend")}}),c.play()):ja===ha*ga?(la=!1,r(!0)):a.fire("dragend"))}),a.on("mousedown touchstart",function(){ua=!0,setTimeout(function(){ua=!1},500),P=a,(a.getDraggable()||a.getParent().getDraggable())&&la&&("g_layer"===a.getParent().attrs.name?(M=a.getZIndex(),a.moveToTop()):(M=a.getParent().getZIndex(),a.getParent().moveToTop()))}),a.on("dragend",function(){(a.getDraggable()||a.getParent().getDraggable())&&la?n(a):ja===ha*ga&&(la=!1,r(!0))}),a.on("mouseout",function(){document.body.style.cursor="default"}),_.add(a),_.draw(),ba.draw()}function t(a){var b;if("Safari,5.1.7"===navigator.sayswho||"MSIE,9.0"===navigator.sayswho)return void $("#popup_own_img").popup("open");if(b=a.target.files[0],b.type.match("image.*")){var c=new FileReader;c.onload=function(){return function(b){C=b.target.result,EXIF.getData(a.target.files[0],function(){F=EXIF.getTag(this,"Orientation")}),$(".image0").attr("src",C),q(),setTimeout(function(){q()},500)}}(b),c.readAsDataURL(b)}}function u(a){z=a,va.attr("src","Images/"+z+"/theme.png"),da&&$("#select_theme").html(document.webL10n.get("lb_"+z)),Oa&&localStorage.setItem("s_theme",a),va.attr("style","width:59px; float:left;"),q(),va.attr("style","width:60px; float:left;")}function v(){0===Y.getPos()?$("#bullets0").attr("src","Images/bullets1o.svg"):$("#bullets0").attr("src","Images/bullets0o.svg"),1===Y.getPos()?$("#bullets1").attr("src","Images/bullets1.svg"):$("#bullets1").attr("src","Images/bullets0.svg"),2===Y.getPos()?$("#bullets2").attr("src","Images/bullets1.svg"):$("#bullets2").attr("src","Images/bullets0.svg"),3===Y.getPos()?$("#bullets3").attr("src","Images/bullets1.svg"):$("#bullets3").attr("src","Images/bullets0.svg"),4===Y.getPos()?$("#bullets4").attr("src","Images/bullets1.svg"):$("#bullets4").attr("src","Images/bullets0.svg")}function w(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return null!==d?d[1]:!1}function x(){new Date("10/25/2014")>new Date&&"flowers"!==z&&Oa&&"flowers"!==localStorage.getItem("s_new_theme")&&(Ma.popup("open"),q(),setTimeout(function(){q()},500))}var y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z=!!window.HTMLCanvasElement,_=new Kinetic.Layer({name:"g_layer"}),aa=new Kinetic.Layer({name:"g_back_g_layer"}),ba=new Kinetic.Stage({container:"container",width:document.getElementById("container").width,height:document.getElementById("container").height}),ca=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),da=!1,ea=new Image,fa="",ga=4,ha=6,ia=15,ja=0,ka=!1,la=!1,ma=!1,na=!0,oa=!0,pa=!0,qa=!0,ra=!1,sa=!0,ta=!0,ua=!1,va=$("#select_theme_img"),wa=$("#b_back_g_grid"),xa=$("#b_back_g_image"),ya=$("#b_rotate"),za=$("#b_sound"),Aa=$("#container"),Ba=$("#b_gold"),Ca=$("#b_gold_enabled"),Da=$("#b_gold_disabled"),Ea=$("#b_prev"),Fa=$("#b_next"),Ga=$("#bt_easy"),Ha=$("#bt_med"),Ia=$("#bt_hard"),Ja=$("#bt_close"),Ka=$("#b_image_input"),La=$("#popupTheme"),Ma=$("#popupNewTheme"),Na=1,Oa=function(){var a="modernizr";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}}();"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(a){},function(a){})}),Aa.mouseup(function(){void 0!==P&&"g_layer"!==P.getParent().attrs.name&&setTimeout(function(){P.fire("dragend")},350)}),Aa.touchend(function(){void 0!==P&&"g_layer"!==P.getParent().attrs.name&&setTimeout(function(){P.fire("dragend")},350)}),$(".own_image").click(function(){if("Safari,5.1.7"===navigator.sayswho||"MSIE,9.0"===navigator.sayswho)return void $("#popup_own_img").popup("open");if("file"!==Ka.attr("type")){if(window.MozActivity){var a=new MozActivity({name:"pick",data:{type:"image/jpeg"}});a.onsuccess=function(){C=window.URL.createObjectURL(this.result.blob),$(".image0").attr("src",C),q(),setTimeout(function(){q()},500)}}}else Ka.click()}).show(),Ba.on("change",function(){o(Ba.val())}),window.onload=function(){ta&&(ta=!1,Z||$("#popup_canvas").popup("open"),Y=new Swipe(document.getElementById("image_slider"),{startSlide:1,callback:function(a,b){0===b?$("#bullets0").attr("src","Images/bullets1o.svg"):$("#bullets0").attr("src","Images/bullets0o.svg"),1===b?$("#bullets1").attr("src","Images/bullets1.svg"):$("#bullets1").attr("src","Images/bullets0.svg"),2===b?$("#bullets2").attr("src","Images/bullets1.svg"):$("#bullets2").attr("src","Images/bullets0.svg"),3===b?$("#bullets3").attr("src","Images/bullets1.svg"):$("#bullets3").attr("src","Images/bullets0.svg"),4===b?$("#bullets4").attr("src","Images/bullets1.svg"):$("#bullets4").attr("src","Images/bullets0.svg")}}),document.getElementById("b_image_input").addEventListener("change",t,!1),Ea.click(function(a){Y.prev(),v(),a.preventDefault()}),Fa.click(function(a){Y.next(),v(),a.preventDefault()}),Ga.click(function(a){h(),a.preventDefault()}),Ha.click(function(a){i(),a.preventDefault()}),Ia.click(function(a){j(),a.preventDefault()}),Ja.click(function(a){la=!1,r(!1),a.preventDefault()}),Ma.click(function(a){u("flowers"),$("#popupNewTheme").popup("close"),a.preventDefault()}),La.find("a").click(function(a){u(this.children[0].getAttribute("alt")),La.popup("close"),a.preventDefault()}),La.css({"overflow-y":"auto","min-width":"270px"}),Ba.slider(),Oa?(null===localStorage.getItem("s_back_g_grid")?wa.val("on"):wa.val(localStorage.getItem("s_back_g_grid")),null===localStorage.getItem("s_backg_image")?xa.val("on"):xa.val(localStorage.getItem("s_backg_image")),null===localStorage.getItem("s_rotate")?ya.val("off"):ya.val(localStorage.getItem("s_rotate")),null===localStorage.getItem("s_sound")?za.val("on"):za.val(localStorage.getItem("s_sound")),o(null===localStorage.getItem("s_gold")?"off":localStorage.getItem("s_gold")),u(null===localStorage.getItem("s_theme")?"animals":localStorage.getItem("s_theme"))):(wa.val("on"),xa.val("on"),ya.val("off"),za.val("on"),o("off"),u("animals")),y=w("mascha"),"true"===y&&$(".t_mascha").removeClass("dn"),y=w("shrek"),"true"===y&&($(".t_shrek").removeClass("dn"),$("#favicon").attr("href","favicon_dark.ico")),y=w("theme"),y&&u(y),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(Ea.attr("style","display:none;"),Fa.attr("style","display:none;")),$("#popupSettings").find("label").attr("style","display:inline;"),q(),setTimeout(function(){q()},500))},$(window).resize(function(){q()}),navigator.sayswho=function(){var a=navigator.appName,b=navigator.userAgent,c=b.match(/version\/([.\d]+)/i),d=b.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return d&&null!==c&&(d[2]=c[1]),d=d?[d[1],d[2]]:[a,navigator.appVersion,"-?"]}(),document.webL10n.ready(function(){da=!0,y=w("lang"),y&&y!==document.webL10n.getLanguage()&&(document.webL10n.setLanguage(y),da=!1)}),document.addEventListener("localized",function(){da&&($("html").attr("lang",document.webL10n.getLanguage().substr(0,2)),$("meta[name=description]").attr("content",document.webL10n.get("lb_desc")),$("link[rel=manifest]").attr("href","Manifest/appmanifest_"+document.webL10n.getLanguage().substr(0,2)+".json"),$("link[rel=canonical]").attr("href","https://grrd01.github.io/Puzzle/?lang="+document.webL10n.getLanguage().substr(0,2)),$("#select_theme").html(document.webL10n.get("lb_"+z)),$("#radio0-1").attr("title",document.webL10n.get("lb_image")),$("#radio-offline").attr("title",document.webL10n.get("lb_image")),$(".image0").attr("alt",document.webL10n.get("lb_image")),setTimeout(function(){x()},500)),da=!0})}();