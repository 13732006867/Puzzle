/*
* grrd's Puzzle
* Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
* Licensed under the MPL License
*/
"use strict";!function(){function a(){E>D?ja?(Y=9,Z=6):(Y=3,Z=2):ja?(Y=6,Z=9):(Y=2,Z=3),d()}function b(){E>D?ja?(Y=12,Z=8):(Y=6,Z=4):ja?(Y=8,Z=12):(Y=4,Z=6),d()}function c(){E>D?ja?(Y=18,Z=12):(Y=8,Z=5):ja?(Y=12,Z=18):(Y=5,Z=8),d()}function d(){var a=$("input:radio[name=image-set-"+Q.getPos()+"]:checked").val();if(!ba){if("undefined"==typeof a)return void alert(navigator.mozL10n.get("lbchoose"));if(void 0===B&&0===Q.getPos())return void alert(navigator.mozL10n.get("lbchoose"));ba=!0,$.mobile.showPageLoadingMsg("a",navigator.mozL10n.get("lbload"),!1),ga="on"===na.val(),ha="on"===oa.val(),da="on"===pa.val(),ia="on"===qa.val(),navigator.sayswho.indexOf("MSIE")<0&&(localStorage.setItem("s_backg_grid",na.val()),localStorage.setItem("s_backg_image",oa.val()),localStorage.setItem("s_rotate",pa.val()),localStorage.setItem("s_sound",qa.val())),document.getElementById("container").width=D,document.getElementById("container").height=E,G=E-4,F=D,A=0!==Q.getPos()?"Images/"+z+"/image-set-"+Q.getPos()+"/sujet"+X+a+".jpg":B,$("#g_imageObj").one("load",function(){W=document.getElementById("g_imageObj"),e()}).attr("src",A).each(function(){navigator.sayswho.indexOf("MSIE")>=0&&this.complete&&$(this).trigger("load")})}}function e(){L=new Array(Y);for(var a=0;Y>a;a++)L[a]=new Array(Z);aa=0,R.removeChildren(),S.removeChildren(),T.removeChildren(),T.setWidth(F),T.setHeight(G),M=0,N=0,O=F/Z,P=G/Y,Ca=1,T.add(R);var b=F,c=G;if(U){var d=f(W,W.naturalHeight);c/=d}(5===C||6===C||7===C||8===C)&&(b=G,c=F);var e=new Kinetic.Image({width:b,height:c,crop:{x:0,y:0,width:W.width,height:W.height},Image:W});0!==Q.getPos()||5!==C&&6!==C||(e.setRotationDeg(90),e.setX(F)),0!==Q.getPos()||3!==C&&4!==C||(e.setRotationDeg(180),e.setX(F),e.setY(G)),0!==Q.getPos()||7!==C&&8!==C||(e.setRotationDeg(270),e.setY(G)),e.toImage({width:F,height:G,callback:function(a){if((ga||ha)&&i(a),fa)e.toImage({width:F,height:G,callback:function(a){for(var b=0;Y>b;b++)for(var c=0;Z>c;c++)Ca=b%2!==0&&c%2!==0||b%2===0&&c%2===0?1:-1,g(c,b,Ca,a);R.draw(),j()}});else{for(var b=0;Y>b;b++)for(var c=0;Z>c;c++)Ca=b%2!==0&&c%2!==0||b%2===0&&c%2===0?1:-1,g(c,b,Ca,a);R.draw(),j()}}})}function f(a,b){var c=document.createElement("canvas");c.width=1,c.height=b;var d=c.getContext("2d");d.drawImage(a,0,0);for(var e=d.getImageData(0,0,1,b).data,f=0,g=b,h=b;h>f;){var i=e[4*(h-1)+3];0===i?g=h:f=h,h=g+f>>1}var j=h/b;return 0===j?1:j}function g(a,b,c,d){!function(){if(fa){var e=new Kinetic.Shape({drawFunc:function(d){d.beginPath(),d.moveTo(M,N),0===b?d.lineTo(M+O,N):(d.bezierCurveTo(M+.8*O,N+.1*P*c,M,N-.25*P*c,M+O/2,N-.25*P*c),d.bezierCurveTo(M+O,N-.25*P*c,M+.2*O,N+.1*P*c,M+O,N)),a===Z-1?d.lineTo(M+O,N+P):(d.bezierCurveTo(M+O+.1*O*c,N+.8*P,M+O-.25*O*c,N,M+O-.25*O*c,N+P/2),d.bezierCurveTo(M+O-.25*O*c,N+P,M+O+.1*O*c,N+.2*P,M+O,N+P)),b===Y-1?d.lineTo(M,N+P):(d.bezierCurveTo(M+.2*O,N+P-.1*P*c,M+O,N+P+.25*P*c,M+O/2,N+P+.25*P*c),d.bezierCurveTo(M,N+P+.25*P*c,M+.8*O,N+P-.1*P*c,M,N+P)),0===a?d.lineTo(M,N):(d.bezierCurveTo(M-.1*O*c,N+.2*P,M+.25*O*c,N+P,M+.25*O*c,N+P/2),d.bezierCurveTo(M+.25*O*c,N,M-.1*O*c,N+.8*P,M,N)),d.closePath(),d.fillStrokeShape(this)},fillPatternImage:d,fillPatternOffset:[a*O,b*P],stroke:"black",strokeWidth:4});e.toImage({width:O+.6*O,height:P+.6*P,x:.3*-O,y:.3*-P,callback:function(c){var d=new Kinetic.Image({image:c,x:a*O+O/2,origx:a*O+O/2,y:b*P+P/2,origy:b*P+P/2,zeile:b,spalte:a,offset:[O/2+.3*O,P/2+.3*P],draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>F&&(c=F),0>b&&(b=0),b>G&&(b=G),{x:c,y:b}},name:"part_z"+b+"_s"+a});h(d),d.createImageHitRegion(function(){R.drawHit()})}}),e.setStrokeWidth(null),e.setStroke(null),e.toImage({width:O+.6*O,height:P+.6*P,x:.3*-O,y:.3*-P,callback:function(c){L[b][a]=c}})}else{var f=new Kinetic.Image({x:a*O+O/2,origx:a*O+O/2,y:b*P+P/2,origy:b*P+P/2,zeile:b,spalte:a,width:O,height:P,offset:[O/2,P/2],crop:{x:d.width/Z*a,y:d.height/Y*b,width:d.width/Z,height:d.height/Y},stroke:"black",strokeWidth:4,fill:"black",Image:d,draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>F&&(c=F),0>b&&(b=0),b>G&&(b=G),{x:c,y:b}},name:"part_z"+b+"_s"+a});h(f)}}()}function h(a){var b,c,d,e=null;ea&&(a.enableShadow(),a.shadowColor("black"),a.shadowOffset(5),a.shadowDarkness(.3),a.shadowBlur(10)),a.on("mouseover",function(){(a.getDraggable()||a.getParent().getDraggable())&&ca&&(document.body.style.cursor="pointer")}),a.on("click tap",function(){la!==!1&&((a.getDraggable()||a.getParent().getDraggable())&&ca&&da&&H===R.getChildren().length-1?"g_layer"===a.getParent().attrs.name?(c=a.getRotation(),ca=!1,d=new Kinetic.Tween({node:a,duration:.5,rotation:c+Math.PI/2,onFinish:function(){ca=!0,360===a.getRotationDeg()&&a.setRotationDeg(0),a.fire("dragend")}}),d.play()):(c=a.getParent().getRotation(),ca=!1,d=new Kinetic.Tween({node:a.getParent(),duration:.5,rotation:c+Math.PI/2,onFinish:function(){ca=!0,360===a.getParent().getRotationDeg()&&a.getParent().setRotationDeg(0),a.fire("dragend")}}),d.play()):aa===Z*Y?(ca=!1,p()):a.fire("dragend"))}),a.on("mousedown touchstart",function(){if(la=!0,setTimeout(function(){la=!1},500),K=a,(a.getDraggable()||a.getParent().getDraggable())&&ca)if("g_layer"===a.getParent().attrs.name)H=a.getZIndex(),a.moveToTop(),ea&&(e&&e.stop(),a.setAttrs({scale:{x:1.05,y:1.05}}),a.shadowOffset(15));else if(H=a.getParent().getZIndex(),a.getParent().moveToTop(),ea){e&&e.stop(),a.getParent().setAttrs({scale:{x:1.05,y:1.05}}),b=a.getParent().getChildren();for(var c=0;c<b.length;c++)b[c].shadowOffset(15)}}),a.on("dragend",function(){if((a.getDraggable()||a.getParent().getDraggable())&&ca)if(ea&&"g_layer"===a.getParent().attrs.name)d=new Kinetic.Tween({node:a,duration:.5,easing:Kinetic.Easings.ElasticEaseOut,scaleX:1,scaleY:1,shadowOffsetX:5,shadowOffsetY:5,onFinish:function(){l(a)}}),d.play();else if(ea&&"g_layer"!==a.getParent().attrs.name){d=new Kinetic.Tween({node:a.getParent(),duration:.5,easing:Kinetic.Easings.ElasticEaseOut,scaleX:1,scaleY:1,onFinish:function(){l(a)}}),d.play(),b=a.getParent().getChildren();for(var c=0;c<b.length;c++)b[c].shadowOffset(5)}else l(a);else aa===Z*Y&&(ca=!1,p())}),a.on("mouseout",function(){document.body.style.cursor="default"}),R.add(a),R.draw(),T.draw()}function i(a){if(ha){var b=new Kinetic.Image({x:0,y:0,width:F,height:G,Image:a,opacity:.1});S.add(b),b.applyFilter(Kinetic.Filters.Grayscale,null,function(){S.draw()}),S.draw()}if(ga)for(var c=0;Y>c;c++)for(var d=0;Z>d;d++){var e=new Kinetic.Rect({x:d*O,y:c*P,width:O,height:P,stroke:"#333333",strokeWidth:2});S.add(e)}T.add(S),S.moveToBottom()}function j(){var a;$.mobile.hidePageLoadingMsg(),$.mobile.changePage("#game",{transition:"slidefade"}),setTimeout(function(){for(var b=R.getChildren(),c=0;c<b.length;c++)da?(a=new Kinetic.Tween({node:b[c],x:Math.floor(Math.random()*O*(Z-1))+O/2,y:Math.floor(Math.random()*P*(Y-1))+P/2,rotation:.5*Math.PI*Math.floor(4*Math.random()),duration:1,onFinish:function(){k()}}),a.play()):(a=new Kinetic.Tween({node:b[c],x:Math.floor(Math.random()*O*(Z-1))+O/2,y:Math.floor(Math.random()*P*(Y-1))+P/2,duration:1,onFinish:function(){k()}}),a.play())},2e3)}function k(){ca=!0,ba=!1}function l(a){var b;if(I="g_layer"===a.getParent().attrs.name?a.getRotationDeg():(a.getRotationDeg()+a.getParent().getRotationDeg())%360,Math.abs(a.getAbsolutePosition().x-a.attrs.origx)<_&&Math.abs(a.getAbsolutePosition().y-a.attrs.origy)<_&&0===I)if("g_layer"===a.getParent().attrs.name)m(a);else for(b=a.getParent().getChildren();b.length>0;){var c=b[0];c.moveTo(R),m(c)}else if("g_layer"===a.getParent().attrs.name)n(a);else{b=a.getParent().getChildren();for(var d=0;d<b.length;d++)n(b[d])}}function m(a){void 0!==a&&(a.setX(a.attrs.origx),a.setY(a.attrs.origy),a.setRotationDeg(0),a.moveToBottom(),a.setStrokeWidth(null),a.setStroke(null),a.setDraggable(!1),fa&&a.setImage(L[a.attrs.zeile][a.attrs.spalte]),R.draw(),(ea||fa)&&a.disableShadow(),ia&&document.getElementById("click_sound").play(),document.body.style.cursor="default",setTimeout(function(){aa++,aa===Z*Y&&(ya.css("display","none"),ia&&document.getElementById("ding_sound").play())},500))}function n(a){var b,c,d=[-1,1,0,0],e=[0,0,-1,1];I="g_layer"===a.getParent().attrs.name?a.getRotationDeg():(a.getRotationDeg()+a.getParent().getRotationDeg())%360;for(var f=0;f<d.length;f++){var g=T.get(".part_z"+(a.attrs.zeile+e[f])+"_s"+(a.attrs.spalte+d[f]));g.length>0&&(J="g_layer"===g[0].getParent().attrs.name?g[0].getRotationDeg():(g[0].getRotationDeg()+g[0].getParent().getRotationDeg())%360,0===I&&(b=a.getAbsolutePosition().x+O*d[f],c=a.getAbsolutePosition().y+P*e[f]),90===I&&(b=a.getAbsolutePosition().x-P*e[f],c=a.getAbsolutePosition().y+O*d[f]),180===I&&(b=a.getAbsolutePosition().x-O*d[f],c=a.getAbsolutePosition().y-P*e[f]),270===I&&(b=a.getAbsolutePosition().x+P*e[f],c=a.getAbsolutePosition().y-O*d[f]),Math.abs(b-g[0].getAbsolutePosition().x)<_&&Math.abs(c-g[0].getAbsolutePosition().y)<_&&I===J&&("g_layer"===a.getParent().attrs.name||"g_layer"===g[0].getParent().attrs.name||a.getParent()!==g[0].getParent())&&o(a,g[0],b,c))}}function o(a,b,c,d){var e,f,g,h,i;if("g_layer"===a.getParent().attrs.name)if("g_layer"===b.getParent().attrs.name){b.setX(c),b.setY(d);var j=new Kinetic.Group({draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>F&&(c=F),0>b&&(b=0),b>G&&(b=G),{x:c,y:b}},name:"gruppe"});a.moveTo(j),b.moveTo(j),a.setDraggable(!1),b.setDraggable(!1),R.add(j)}else f=a.getX(),g=a.getY(),b.getParent().setX(b.getParent().getX()+c-b.getAbsolutePosition().x),b.getParent().setY(b.getParent().getY()+d-b.getAbsolutePosition().y),a.moveTo(b.getParent()),a.setRotationDeg(b.getRotationDeg()),h=f-a.getAbsolutePosition().x,i=g-a.getAbsolutePosition().y,0===a.getParent().getRotationDeg()&&(a.setX(a.getX()+h),a.setY(a.getY()+i)),90===a.getParent().getRotationDeg()&&(a.setY(a.getY()-h),a.setX(a.getX()+i)),180===a.getParent().getRotationDeg()&&(a.setX(a.getX()-h),a.setY(a.getY()-i)),270===a.getParent().getRotationDeg()&&(a.setY(a.getY()+h),a.setX(a.getX()-i)),a.setDraggable(!1);else if("g_layer"===b.getParent().attrs.name)b.moveTo(a.getParent()),b.setAbsolutePosition(c,d),b.setRotationDeg(a.getRotationDeg()),b.setDraggable(!1);else{e=b.getParent().getChildren();for(var k=c-b.getAbsolutePosition().x,l=d-b.getAbsolutePosition().y;e.length>0;)if(void 0!==e[0]){var m=e[0];f=m.getAbsolutePosition().x,g=m.getAbsolutePosition().y,m.moveTo(a.getParent()),m.setRotationDeg(a.getRotationDeg()),h=f-m.getAbsolutePosition().x+k,i=g-m.getAbsolutePosition().y+l,0===a.getParent().getRotationDeg()&&(m.setX(m.getX()+h),m.setY(m.getY()+i)),90===a.getParent().getRotationDeg()&&(m.setY(m.getY()-h),m.setX(m.getX()+i)),180===a.getParent().getRotationDeg()&&(m.setX(m.getX()-h),m.setY(m.getY()-i)),270===a.getParent().getRotationDeg()&&(m.setY(m.getY()+h),m.setX(m.getX()-i))}}e=a.getParent().getChildren();for(var n=e[0].getAbsolutePosition().x,o=e[0].getAbsolutePosition().x,p=e[0].getAbsolutePosition().y,q=e[0].getAbsolutePosition().y,r=0;r<e.length;r++)e[r].getAbsolutePosition().x<n&&(n=e[r].getAbsolutePosition().x),e[r].getAbsolutePosition().x>o&&(o=e[r].getAbsolutePosition().x),e[r].getAbsolutePosition().y<p&&(p=e[r].getAbsolutePosition().y),e[r].getAbsolutePosition().y>q&&(q=e[r].getAbsolutePosition().y);f=a.getAbsolutePosition().x,g=a.getAbsolutePosition().y,a.getParent().setOffset(0,0),a.getParent().setX((n+o)/2),a.getParent().setY((p+q)/2),h=f-a.getAbsolutePosition().x,i=g-a.getAbsolutePosition().y,0===a.getParent().getRotationDeg()&&a.getParent().setOffset(-1*h,-1*i),90===a.getParent().getRotationDeg()&&a.getParent().setOffset(-1*i,h),180===a.getParent().getRotationDeg()&&a.getParent().setOffset(h,i),270===a.getParent().getRotationDeg()&&a.getParent().setOffset(i,-1*h),"g_layer"===b.getParent().attrs.name?b.moveToTop():b.getParent().moveToTop(),R.draw(),ia&&document.getElementById("click_sound").play()}function p(){ya.css("display","inline"),$.mobile.changePage("#title",{transition:"slidefade",reverse:!0}),t(),setTimeout(function(){t()},500)}function q(a){if("Safari,5.1.7"==navigator.sayswho||"MSIE,9.0"==navigator.sayswho)return void alert(navigator.mozL10n.get("lbownimg"));for(var b,c=a.target.files,d=0;b=c[d];d++)if(b.type.match("image.*")){var e=new FileReader;e.onload=function(){return function(a){B=a.target.result;var b=atob(B.split(",")[1]),c=EXIF.readFromBinaryFile(new BinaryFile(b));C=c.Orientation,$("#image0").attr("src",B),t(),setTimeout(function(){t()},500)}}(b),e.readAsDataURL(b)}}function r(a){z=a,ma.attr("src","Images/"+z+"/theme.png"),V&&$("#select_theme").html(navigator.mozL10n.get("lb"+z)),navigator.sayswho.indexOf("MSIE")<0&&localStorage.setItem("s_theme",a),ma.attr("style","width:59px; float:left;"),t(),ma.attr("style","width:60px; float:left;")}function s(a){sa.val(a),localStorage.setItem("s_gold",sa.val()),"on"===sa.val()?(ja=!0,$("#imgeasy").attr("src","Images/easy_gold.png"),$("#imgmed").attr("src","Images/medium_gold.png"),$("#imghard").attr("src","Images/hard_gold.png")):(ja=!1,$("#imgeasy").attr("src","Images/easy.png"),$("#imgmed").attr("src","Images/medium.png"),$("#imghard").attr("src","Images/hard.png"))}function t(){E=$(window).height(),D=$(window).width(),X="",E>D?(X="p",$("#img_title").attr("style","width:100%;"),$("#image0").attr("style","height:"+1.5*(D/3-50)+"px;")):($("#img_title").attr("style","max-height:"+E/5+"px;"),$("#image0").attr("style","height:"+(D/3-50)/1.5+"px;")),Aa.css("max-height",E-10+"px"),Ba.css("max-width",D-10+"px"),va.attr("style","width:"+(D/3-12)+"px;"),wa.attr("style","width:"+(D/3-12)+"px;"),xa.attr("style","width:"+(D/3-12)+"px;");for(var a=1;5>a;a++)for(var b=1;4>b;b++)$("#radio"+a+"-"+b).attr("style","width:"+(D/3-12)+"px;"),$("#image"+a+"-"+b).attr("src","Images/"+z+"/image-set-"+a+"/sujet"+X+b+"s.jpg")}function u(){0===Q.getPos()?$("#bullets0").attr("src","Images/bulletso1.png"):$("#bullets0").attr("src","Images/bulletso0.png"),1===Q.getPos()?$("#bullets1").attr("src","Images/bullets1.png"):$("#bullets1").attr("src","Images/bullets0.png"),2===Q.getPos()?$("#bullets2").attr("src","Images/bullets1.png"):$("#bullets2").attr("src","Images/bullets0.png"),3===Q.getPos()?$("#bullets3").attr("src","Images/bullets1.png"):$("#bullets3").attr("src","Images/bullets0.png"),4===Q.getPos()?$("#bullets4").attr("src","Images/bullets1.png"):$("#bullets4").attr("src","Images/bullets0.png")}function v(){new Date("10/25/2014")>new Date&&"flowers"!=z&&"flowers"!==localStorage.getItem("s_new_theme")&&(Ba.popup("open"),t(),setTimeout(function(){t()},500))}function w(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return null!==d?d[1]:!1}var x=!!window.HTMLCanvasElement;x||alert("Your browser does not support HTML5. Please use a modern browser like Chrome or Firefox.");var y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R=new Kinetic.Layer({name:"g_layer"}),S=new Kinetic.Layer({name:"g_backg_layer"}),T=new Kinetic.Stage({container:"container",width:document.getElementById("container").width,height:document.getElementById("container").height}),U=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,V=!1,W=new Image,X="",Y=4,Z=6,_=15,aa=0,ba=!1,ca=!1,da=!1,ea=!1,fa=!0,ga=!0,ha=!0,ia=!0,ja=!1,ka=!0,la=!1,ma=$("#select_theme_img"),na=$("#b_backg_grid"),oa=$("#b_backg_image"),pa=$("#b_rotate"),qa=$("#b_sound"),ra=$("#container"),sa=$("#b_gold"),ta=$("#bprev"),ua=$("#bnext"),va=$("#bteasy"),wa=$("#btmed"),xa=$("#bthard"),ya=$("#btclose"),za=$("#b_imageinput"),Aa=$("#popupTheme"),Ba=$("#popupNewTheme"),Ca=1;ra.mouseup(function(){void 0!==K&&"g_layer"!==K.getParent().attrs.name&&setTimeout(function(){K.fire("dragend")},350)}),ra.touchend(function(){void 0!==K&&"g_layer"!==K.getParent().attrs.name&&setTimeout(function(){K.fire("dragend")},350)}),$("#image-set-0").click(function(){if("Safari,5.1.7"==navigator.sayswho||"MSIE,9.0"==navigator.sayswho)return void alert(navigator.mozL10n.get("lbownimg"));if("file"!==za.attr("type")){if(window.MozActivity){var a=new MozActivity({name:"pick",data:{type:"image/jpeg"}});a.onsuccess=function(){B=window.URL.createObjectURL(this.result.blob),$("#image0").attr("src",B),t(),setTimeout(function(){t()},500)},a.onerror=function(){}}}else za.click()}).show(),sa.on("change",function(){s(sa.val())}),window.onload=function(){ka&&(ka=!1,Q=new Swipe(document.getElementById("image_slider"),{startSlide:1,callback:function(a,b){0===b?$("#bullets0").attr("src","Images/bulletso1.png"):$("#bullets0").attr("src","Images/bulletso0.png"),1===b?$("#bullets1").attr("src","Images/bullets1.png"):$("#bullets1").attr("src","Images/bullets0.png"),2===b?$("#bullets2").attr("src","Images/bullets1.png"):$("#bullets2").attr("src","Images/bullets0.png"),3===b?$("#bullets3").attr("src","Images/bullets1.png"):$("#bullets3").attr("src","Images/bullets0.png"),4===b?$("#bullets4").attr("src","Images/bullets1.png"):$("#bullets4").attr("src","Images/bullets0.png")}}),document.getElementById("b_imageinput").addEventListener("change",q,!1),ta.click(function(a){Q.prev(),u(),a.preventDefault()}),ua.click(function(a){Q.next(),u(),a.preventDefault()}),va.click(function(b){a(),b.preventDefault()}),wa.click(function(a){b(),a.preventDefault()}),xa.click(function(a){c(),a.preventDefault()}),ya.click(function(a){ca=!1,p(),a.preventDefault()}),Ba.click(function(a){r("flowers"),$("#popupNewTheme").popup("close"),a.preventDefault()}),Aa.find("a").click(function(a){r(this.children[0].getAttribute("alt")),Aa.popup("close"),a.preventDefault()}),Aa.css({"overflow-y":"auto","min-width":"270px"}),navigator.sayswho.indexOf("MSIE")>=0?(na.val("on"),oa.val("on"),pa.val("off"),qa.val("on"),s("off")):(null===localStorage.getItem("s_backg_grid")?na.val("on"):na.val(localStorage.getItem("s_backg_grid")),null===localStorage.getItem("s_backg_image")?oa.val("on"):oa.val(localStorage.getItem("s_backg_image")),null===localStorage.getItem("s_rotate")?pa.val("off"):pa.val(localStorage.getItem("s_rotate")),null===localStorage.getItem("s_sound")?qa.val("on"):qa.val(localStorage.getItem("s_sound")),s(null===localStorage.getItem("s_gold")?"off":localStorage.getItem("s_gold")),r(null===localStorage.getItem("s_theme")?"animals":localStorage.getItem("s_theme"))),y=w("theme"),y&&r(y),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(ta.attr("style","display:none;"),ua.attr("style","display:none;")),/Android/i.test(navigator.userAgent)||(za.attr("style","display:none;"),$("#b_titimageinput").attr("style","display:none;")),$("#popupSettings").find("label").attr("style","display:inline;"),t(),setTimeout(function(){t()},500))},$(window).resize(function(){t()}),navigator.sayswho=function(){var a,b=navigator.appName,c=navigator.userAgent,d=c.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return d&&null!=(a=c.match(/version\/([\.\d]+)/i))&&(d[2]=a[1]),d=d?[d[1],d[2]]:[b,navigator.appVersion,"-?"]}(),navigator.mozL10n.ready(function(){V=!0,y=w("lang"),y&&y!==navigator.mozL10n.language.code&&(navigator.mozL10n.language.code=y),$("#select_theme").html(navigator.mozL10n.get("lb"+z)),setTimeout(function(){v()},500)})}();