/*
* grrd's Puzzle
* Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
* Licensed under the MPL License
*/

!function(){"use strict";var e,s,a,t,o,n,i,g,r,l,p,_,c,m,u,d,h,f,b,v,w,P,y,I,k,x,D,T,S,A,R,C=!!window.HTMLCanvasElement,L=new Kinetic.Layer({name:"g_layer"}),M=new Kinetic.Layer({name:"g_back_g_layer"}),X=new Kinetic.Stage({container:"container",width:document.getElementById("container").width,height:document.getElementById("container").height}),Y=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),E=!1,z=0,B=0,K=!1,O=2,F=new Image,j="",W=4,H=6,N=15,U=0,Z=!1,G=!1,V=!1,q=!0,J=!0,Q=!0,ee=!0,te=!1,ae=!0,oe=!0,ne=!1,se=$("#select_theme_img"),ie=$("#b_back_g_grid"),ge=$("#b_back_g_image"),re=$("#b_rotate"),le=$("#b_sound"),ce=$("#container"),me=$("#b_gold"),ue=$("#b_gold_enabled"),de=$("#b_gold_disabled"),he=$("#b_prev"),fe=$("#b_next"),be=$("#bt_easy"),ve=$("#bt_med"),pe=$("#bt_hard"),_e=$("#bt_close"),we=$("#b_image_input"),Pe=$("#popupTheme"),ye=$("#popupNewTheme"),Ie=function(){var e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function $e(){Z=!(G=!0)}function ke(){var t;$.mobile.hidePageLoadingMsg(),$.mobile.changePage("#game",{transition:"slide"}),setTimeout(function(){var e=L.getChildren();for(t=0;t<e.length;t+=1)e[t].setZIndex(Math.floor(Math.random()*H*W));for(t=0;t<e.length;t+=1)V?new Kinetic.Tween({node:e[t],x:Math.floor(Math.random()*k*(H-1))+k/2,y:Math.floor(Math.random()*x*(W-1))+x/2,rotation:.5*Math.PI*Math.floor(4*Math.random()),duration:1,onFinish:$e()}).play():new Kinetic.Tween({node:e[t],x:Math.floor(Math.random()*k*(H-1))+k/2,y:Math.floor(Math.random()*x*(W-1))+x/2,duration:1,onFinish:$e()}).play()},2e3)}function xe(a,o,n,s){!function(){var t;if(q){var e=new Kinetic.Shape({drawFunc:function(e){e.beginPath(),e.moveTo(y,I),0===o?e.lineTo(y+k,I):(e.bezierCurveTo(y+.8*k,I+.1*x*n,y,I-.25*x*n,y+k/2,I-.25*x*n),e.bezierCurveTo(y+k,I-.25*x*n,y+.2*k,I+.1*x*n,y+k,I)),a===H-1?e.lineTo(y+k,I+x):(e.bezierCurveTo(y+k+.1*k*n,I+.8*x,y+k-.25*k*n,I,y+k-.25*k*n,I+x/2),e.bezierCurveTo(y+k-.25*k*n,I+x,y+k+.1*k*n,I+.2*x,y+k,I+x)),o===W-1?e.lineTo(y,I+x):(e.bezierCurveTo(y+.2*k,I+x-.1*x*n,y+k,I+x+.25*x*n,y+k/2,I+x+.25*x*n),e.bezierCurveTo(y,I+x+.25*x*n,y+.8*k,I+x-.1*x*n,y,I+x)),0===a?e.lineTo(y,I):(e.bezierCurveTo(y-.1*k*n,I+.2*x,y+.25*k*n,I+x,y+.25*k*n,I+x/2),e.bezierCurveTo(y+.25*k*n,I,y-.1*k*n,I+.8*x,y,I)),e.closePath(),e.fillStrokeShape(this)},fillPatternImage:s,fillPatternOffset:[a*k,o*x],stroke:"black",strokeWidth:4});e.toImage({width:k+.6*k,height:x+.6*x,x:.3*-k,y:.3*-x,callback:function(e){Ye(t=new Kinetic.Image({image:e,x:a*k+k/2,origX:a*k+k/2,y:o*x+x/2,origY:o*x+x/2,row:o,col:a,offset:[k/2+.3*k,x/2+.3*x],draggable:!0,dragBoundFunc:function(e){var t=e.y,a=e.x;return a<0&&(a=0),p<a&&(a=p),t<0&&(t=0),_<t&&(t=_),{x:a,y:t}},name:"part_z"+o+"_s"+a})),t.createImageHitRegion(function(){L.drawHit()})}}),e.setStrokeWidth(null),e.setStroke(null),e.toImage({width:k+.6*k,height:x+.6*x,x:.3*-k,y:.3*-x,callback:function(e){b[o][a]=e}})}else Ye(t=new Kinetic.Image({x:a*k+k/2,origX:a*k+k/2,y:o*x+x/2,origY:o*x+x/2,row:o,col:a,width:k,height:x,offset:[k/2,x/2],crop:{x:s.width/H*a,y:s.height/W*o,width:s.width/H,height:s.height/W},stroke:"black",strokeWidth:4,fill:"black",Image:s,draggable:!0,dragBoundFunc:function(e){var t=e.y,a=e.x;return a<0&&(a=0),p<a&&(a=p),t<0&&(t=0),_<t&&(t=_),{x:a,y:t}},name:"part_z"+o+"_s"+a}))}()}function De(){var t,a;for(b=[],t=0;t<W;t+=1)b[t]=[];U=0,L.removeChildren(),M.removeChildren(),X.removeChildren(),X.setWidth(p),X.setHeight(_),I=y=0,k=p/H,x=_/W,1,X.add(L);var e=p,o=_;Y&&(o/=function(e,t){var a=document.createElement("canvas");a.width=1,a.height=t;var o=a.getContext("2d");o.drawImage(e,0,0);for(var n=o.getImageData(0,0,1,t).data,s=0,i=t,g=t;s<g;)0===n[4*(g-1)+3]?i=g:s=g,g=i+s>>1;var r=g/t;return 0===r?1:r}(F,F.naturalHeight));0!==D.getPos()||5!==g&&6!==g&&7!==g&&8!==g||(e=_,o=p);var n=new Kinetic.Image({width:e,height:o,crop:{x:0,y:0,width:F.width,height:F.height},Image:F});0!==D.getPos()||5!==g&&6!==g||(n.setRotationDeg(90),n.setX(p)),0!==D.getPos()||3!==g&&4!==g||(n.setRotationDeg(180),n.setX(p),n.setY(_)),0!==D.getPos()||7!==g&&8!==g||(n.setRotationDeg(270),n.setY(_)),n.toImage({width:p,height:_,callback:function(e){if((J||Q)&&function(e){var t,a,o,n;if(Q&&(t=new Kinetic.Image({x:0,y:0,width:p,height:_,Image:e,opacity:.1}),M.add(t),M.draw()),J)for(a=0;a<W;a+=1)for(o=0;o<H;o+=1)n=new Kinetic.Rect({x:o*k,y:a*x,width:k,height:x,stroke:"#333333",strokeWidth:2}),M.add(n);X.add(M),M.moveToBottom()}(e),q)n.toImage({width:p,height:_,callback:function(e){for(a=0;a<W;a+=1)for(t=0;t<H;t+=1)xe(t,a,a%2!=0&&t%2!=0||a%2==0&&t%2==0?1:-1,e);L.draw(),ke()}});else{for(a=0;a<W;a+=1)for(t=0;t<H;t+=1)xe(t,a,a%2!=0&&t%2!=0||a%2==0&&t%2==0?1:-1,e);L.draw(),ke()}}})}function Te(){w=D.getPos(),v=$("input:radio[name=image-set-"+w+"]:checked").val(),Z||(void 0!==v&&(void 0!==o||0!==w)?ae&&$("#image"+w+"-"+v).hasClass("locked")||(Z=!0,$.mobile.showPageLoadingMsg("a",document.webL10n.get("lb_load"),!1),J="on"===ie.val(),Q="on"===ge.val(),V="on"===re.val(),ee="on"===le.val(),Ie&&(localStorage.setItem("s_back_g_grid",ie.val()),localStorage.setItem("s_backg_image",ge.val()),localStorage.setItem("s_rotate",re.val()),localStorage.setItem("s_sound",le.val())),document.getElementById("container").width=r,document.getElementById("container").height=l,_=l-4,p=r,m=j,0!==w?(i=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,n=Math.min(l,r)*i<=270?"s":1080<Math.min(l,r)*i?"l":"",t="Images/"+s+"/image-set-"+w+"/sujet"+j+v+n+".jpg"):t=o,$("#g_imageObj").one("load",function(){F=document.getElementById("g_imageObj"),De()}).attr("src",t).each(function(){0<=navigator.sayswho.indexOf("MSIE")&&this.complete&&$(this).trigger("load")})):$("#popup_choose").popup("open"))}function Se(e,t,a,o){var n,s,i,g,r,l,c;if("g_layer"===e.getParent().attrs.name)if("g_layer"===t.getParent().attrs.name){t.setX(a),t.setY(o);var m=new Kinetic.Group({draggable:!0,dragBoundFunc:function(e){var t=e.y,a=e.x;return a<0&&(a=0),p<a&&(a=p),t<0&&(t=0),_<t&&(t=_),{x:a,y:t}}});e.moveTo(m),t.moveTo(m),e.setDraggable(!1),t.setDraggable(!1),L.add(m)}else g=e.getX(),r=e.getY(),t.getParent().setX(t.getParent().getX()+a-t.getAbsolutePosition().x),t.getParent().setY(t.getParent().getY()+o-t.getAbsolutePosition().y),e.moveTo(t.getParent()),e.setRotationDeg(t.getRotationDeg()),l=g-e.getAbsolutePosition().x,c=r-e.getAbsolutePosition().y,0===e.getParent().getRotationDeg()&&(e.setX(e.getX()+l),e.setY(e.getY()+c)),90===e.getParent().getRotationDeg()&&(e.setY(e.getY()-l),e.setX(e.getX()+c)),180===e.getParent().getRotationDeg()&&(e.setX(e.getX()-l),e.setY(e.getY()-c)),270===e.getParent().getRotationDeg()&&(e.setY(e.getY()+l),e.setX(e.getX()-c)),e.setDraggable(!1);else if("g_layer"===t.getParent().attrs.name)t.moveTo(e.getParent()),t.setAbsolutePosition(a,o),t.setRotationDeg(e.getRotationDeg()),t.setDraggable(!1);else{s=t.getParent().getChildren();for(var u=a-t.getAbsolutePosition().x,d=o-t.getAbsolutePosition().y;0<s.length;)void 0!==s[0]&&(g=(i=s[0]).getAbsolutePosition().x,r=i.getAbsolutePosition().y,i.moveTo(e.getParent()),i.setRotationDeg(e.getRotationDeg()),l=g-i.getAbsolutePosition().x+u,c=r-i.getAbsolutePosition().y+d,0===e.getParent().getRotationDeg()&&(i.setX(i.getX()+l),i.setY(i.getY()+c)),90===e.getParent().getRotationDeg()&&(i.setY(i.getY()-l),i.setX(i.getX()+c)),180===e.getParent().getRotationDeg()&&(i.setX(i.getX()-l),i.setY(i.getY()-c)),270===e.getParent().getRotationDeg()&&(i.setY(i.getY()+l),i.setX(i.getX()-c)))}var h=(s=e.getParent().getChildren())[0].getAbsolutePosition().x,f=s[0].getAbsolutePosition().x,b=s[0].getAbsolutePosition().y,v=s[0].getAbsolutePosition().y;for(n=0;n<s.length;n+=1)s[n].getAbsolutePosition().x<h&&(h=s[n].getAbsolutePosition().x),s[n].getAbsolutePosition().x>f&&(f=s[n].getAbsolutePosition().x),s[n].getAbsolutePosition().y<b&&(b=s[n].getAbsolutePosition().y),s[n].getAbsolutePosition().y>v&&(v=s[n].getAbsolutePosition().y);g=e.getAbsolutePosition().x,r=e.getAbsolutePosition().y,e.getParent().setOffset(0,0),e.getParent().setX((h+f)/2),e.getParent().setY((b+v)/2),l=g-e.getAbsolutePosition().x,c=r-e.getAbsolutePosition().y,0===e.getParent().getRotationDeg()&&e.getParent().setOffset(-1*l,-1*c),90===e.getParent().getRotationDeg()&&e.getParent().setOffset(-1*c,l),180===e.getParent().getRotationDeg()&&e.getParent().setOffset(l,c),270===e.getParent().getRotationDeg()&&e.getParent().setOffset(c,-1*l),"g_layer"===t.getParent().attrs.name?t.moveToTop():t.getParent().moveToTop(),L.draw(),ee&&document.getElementById("click_sound").play()}function Ae(e){var t,a,o,n,s=[-1,1,0,0],i=[0,0,-1,1];for(d="g_layer"===e.getParent().attrs.name?e.getRotationDeg():(e.getRotationDeg()+e.getParent().getRotationDeg())%360,t=0;t<s.length;t+=1)0<(n=X.get(".part_z"+(e.attrs.row+i[t])+"_s"+(e.attrs.col+s[t]))).length&&(h="g_layer"===n[0].getParent().attrs.name?n[0].getRotationDeg():(n[0].getRotationDeg()+n[0].getParent().getRotationDeg())%360,0===d&&(a=e.getAbsolutePosition().x+k*s[t],o=e.getAbsolutePosition().y+x*i[t]),90===d&&(a=e.getAbsolutePosition().x-x*i[t],o=e.getAbsolutePosition().y+k*s[t]),180===d&&(a=e.getAbsolutePosition().x-k*s[t],o=e.getAbsolutePosition().y-x*i[t]),270===d&&(a=e.getAbsolutePosition().x+x*i[t],o=e.getAbsolutePosition().y-k*s[t]),Math.abs(a-n[0].getAbsolutePosition().x)<N&&Math.abs(o-n[0].getAbsolutePosition().y)<N&&d===h&&("g_layer"===e.getParent().attrs.name||"g_layer"===n[0].getParent().attrs.name||e.getParent()!==n[0].getParent())&&Se(e,n[0],a,o))}function Re(e){void 0!==e&&(e.setX(e.attrs.origX),e.setY(e.attrs.origY),e.setRotationDeg(0),e.moveToBottom(),e.setStrokeWidth(null),e.setStroke(null),e.setDraggable(!1),q&&e.setImage(b[e.attrs.row][e.attrs.col]),L.draw(),q&&e.disableShadow(),ee&&document.getElementById("click_sound").play(),document.body.style.cursor="default",setTimeout(function(){(U+=1)===H*W&&(_e.css("display","none"),ee&&document.getElementById("ding_sound").play())},500))}function Ce(e){me.val(e).slider("refresh"),Ie&&localStorage.setItem("s_gold",me.val()),"on"===me.val()?(te=!0,$("#img_easy").attr("src","Images/easy_gold.svg"),$("#img_med").attr("src","Images/medium_gold.svg"),$("#img_hard").attr("src","Images/hard_gold.svg")):(te=!1,$("#img_easy").attr("src","Images/easy.svg"),$("#img_med").attr("src","Images/medium.svg"),$("#img_hard").attr("src","Images/hard.svg"))}function Le(){var e,t,a,o,n=0;for(e=1;e<5;e+=1)for(t=1;t<4;t+=1)a=Ie&&localStorage.getItem(s+e+j+t)||0,n+=parseInt(a),ae?0<a?((o=$("#medal"+e+"-"+t)).removeClass("dn"),o.attr("src","Images/medal"+a+".svg"),t<3&&($("#image"+e+"-"+(t+1)).removeClass("locked"),$("#lock"+e+"-"+(t+1)).addClass("dn"))):($("#medal"+e+"-"+t).addClass("dn"),t<3&&($("#image"+e+"-"+(t+1)).addClass("locked"),$("#lock"+e+"-"+(t+1)).removeClass("dn"))):($("#medal"+e+"-"+t).addClass("dn"),$("#image"+e+"-"+(t+1)).removeClass("locked"),$("#lock"+e+"-"+(t+1)).addClass("dn"));36===n?(ue.show(),Ce("on"),me.slider({theme:"d"}).slider("refresh"),de.hide()):(de.show(),Ce("off"),me.slider({theme:"d"}).slider("refresh"),ue.hide())}function Me(){var e,t;if(l=$(window).height(),r=$(window).width(),j="",r<l?(j="p",$("#img_title").attr("style","width:100%;"),$(".image0").attr("style","height:"+1.5*(r/3-50)+"px;"),$(".lock").css({left:"10%",bottom:(r-70)/9.8,width:"80%"})):($("#img_title").attr("style","max-height:"+l/5+"px;"),$(".image0").attr("style","height:"+(r/3-50)/1.5+"px;"),$(".lock").css({left:"25%",bottom:(r-70)/30,width:"50%"})),Pe.css("max-height",l-10+"px"),ye.css("max-width",r-10+"px"),be.attr("style","width:"+(r/3-12)+"px;"),ve.attr("style","width:"+(r/3-12)+"px;"),pe.attr("style","width:"+(r/3-12)+"px;"),navigator.onLine){for(e=1;e<O+1;e+=1)for(t=1;t<4;t+=1)$("#radio"+e+"-"+t).attr("style","width:"+(r/3-12)+"px;"),$("#image"+e+"-"+t).attr("src","Images/"+s+"/image-set-"+e+"/sujet"+j+t+"s.jpg");$(".offline").hide(),$(".online").show()}else $(".offline").show(),$(".online").hide(),D.slide(0,0);s===a&&j===c||(a=s,c=j,Le())}function Xe(e){var t;_e.css("display","inline"),e&&(t=Ie&&localStorage.getItem(s+w+m+v)||0,parseInt(P)>parseInt(t)&&(Ie&&localStorage.setItem(s+w+m+v,P),Le(),ee&&document.getElementById("ding_sound").play())),$.mobile.changePage("#title",{transition:"slide",reverse:!0}),Me(),setTimeout(function(){Me()},500)}function Ye(e){var t;e.on("mouseover",function(){(e.getDraggable()||e.getParent().getDraggable())&&G&&(document.body.style.cursor="pointer")}),e.on("click tap",function(){!1!==ne&&((e.getDraggable()||e.getParent().getDraggable())&&G&&V&&u===L.getChildren().length-1?"g_layer"===e.getParent().attrs.name?(t=e.getRotation(),G=!1,new Kinetic.Tween({node:e,duration:.5,rotation:t+Math.PI/2,onFinish:function(){G=!0,360===e.getRotationDeg()&&e.setRotationDeg(0),e.fire("dragend")}}).play()):(t=e.getParent().getRotation(),G=!1,new Kinetic.Tween({node:e.getParent(),duration:.5,rotation:t+Math.PI/2,onFinish:function(){G=!0,360===e.getParent().getRotationDeg()&&e.getParent().setRotationDeg(0),e.fire("dragend")}}).play()):U===H*W?Xe(!(G=!1)):e.fire("dragend"))}),e.on("mousedown touchstart",function(){ne=!0,setTimeout(function(){ne=!1},500),((f=e).getDraggable()||e.getParent().getDraggable())&&G&&("g_layer"===e.getParent().attrs.name?(u=e.getZIndex(),e.moveToTop()):(u=e.getParent().getZIndex(),e.getParent().moveToTop()))}),e.on("dragend",function(){(e.getDraggable()||e.getParent().getDraggable())&&G?function(e){var t,a,o;if(d="g_layer"===e.getParent().attrs.name?e.getRotationDeg():(e.getRotationDeg()+e.getParent().getRotationDeg())%360,Math.abs(e.getAbsolutePosition().x-e.attrs.origX)<N&&Math.abs(e.getAbsolutePosition().y-e.attrs.origY)<N&&0===d)if("g_layer"===e.getParent().attrs.name)Re(e);else for(a=e.getParent().getChildren();0<a.length;)(o=a[0]).moveTo(L),Re(o);else if("g_layer"===e.getParent().attrs.name)Ae(e);else for(a=e.getParent().getChildren(),t=0;t<a.length;t+=1)Ae(a[t])}(e):U===H*W&&Xe(!(G=!1))}),e.on("mouseout",function(){document.body.style.cursor="default"}),L.add(e),L.draw(),X.draw()}function Ee(t){var e;if("Safari,5.1.7"!==navigator.sayswho&&"MSIE,9.0"!==navigator.sayswho){if((e=t.target.files[0]).type.match("image.*")){var a=new FileReader;a.onload=function(e){o=e.target.result,EXIF.getData(t.target.files[0],function(){g=EXIF.getTag(this,"Orientation")}),$(".image0").attr("src",o),Me(),setTimeout(function(){Me()},500)},a.readAsDataURL(e)}}else $("#popup_own_img").popup("open")}function ze(e){s=e,se.attr("src","Images/"+s+"/theme.png"),E&&$("#select_theme").html(document.webL10n.get("lb_"+s)),Ie&&localStorage.setItem("s_theme",e),se.attr("style","width:59px; float:left;"),Me(),se.attr("style","width:60px; float:left;")}function Be(){0===D.getPos()?$("#bullets0").attr("src","Images/bullets1o.svg"):$("#bullets0").attr("src","Images/bullets0o.svg"),1===D.getPos()?$("#bullets1").attr("src","Images/bullets1.svg"):$("#bullets1").attr("src","Images/bullets0.svg"),2===D.getPos()?$("#bullets2").attr("src","Images/bullets1.svg"):$("#bullets2").attr("src","Images/bullets0.svg"),3===D.getPos()?$("#bullets3").attr("src","Images/bullets1.svg"):$("#bullets3").attr("src","Images/bullets0.svg"),4===D.getPos()?$("#bullets4").attr("src","Images/bullets1.svg"):$("#bullets4").attr("src","Images/bullets0.svg")}function Ke(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null!==t&&t[1]}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){},function(e){})}),ce.mouseup(function(){void 0!==f&&"g_layer"!==f.getParent().attrs.name&&setTimeout(function(){f.fire("dragend")},350)}),ce.touchend(function(){void 0!==f&&"g_layer"!==f.getParent().attrs.name&&setTimeout(function(){f.fire("dragend")},350)}),$(".own_image").click(function(){"Safari,5.1.7"!==navigator.sayswho&&"MSIE,9.0"!==navigator.sayswho?"file"!==we.attr("type")?window.MozActivity&&(new MozActivity({name:"pick",data:{type:"image/jpeg"}}).onsuccess=function(){o=window.URL.createObjectURL(this.result.blob),$(".image0").attr("src",o),Me(),setTimeout(function(){Me()},500)}):we.click():$("#popup_own_img").popup("open")}).show(),me.on("change",function(){Ce(me.val())}),window.onload=function(){oe&&(oe=!1,C||$("#popup_canvas").popup("open"),D=new Swipe(document.getElementById("image_slider"),{startSlide:1,callback:function(e,t){0===t?$("#bullets0").attr("src","Images/bullets1o.svg"):$("#bullets0").attr("src","Images/bullets0o.svg"),1===t?$("#bullets1").attr("src","Images/bullets1.svg"):($("#bullets1").attr("src","Images/bullets0.svg"),O=4,Me()),2===t?$("#bullets2").attr("src","Images/bullets1.svg"):$("#bullets2").attr("src","Images/bullets0.svg"),3===t?$("#bullets3").attr("src","Images/bullets1.svg"):$("#bullets3").attr("src","Images/bullets0.svg"),4===t?$("#bullets4").attr("src","Images/bullets1.svg"):$("#bullets4").attr("src","Images/bullets0.svg")}}),document.getElementById("b_image_input").addEventListener("change",Ee,!1),he.click(function(e){D.prev(),Be(),e.preventDefault()}),fe.click(function(e){D.next(),Be(),e.preventDefault()}),be.click(function(e){P="1",r<l?te?(W=9,H=6):(W=3,H=2):te?(W=6,H=9):(W=2,H=3),Te(),e.preventDefault()}),ve.click(function(e){P="2",r<l?te?(W=12,H=8):(W=6,H=4):te?(W=8,H=12):(W=4,H=6),Te(),e.preventDefault()}),pe.click(function(e){P="3",r<l?te?(W=18,H=12):(W=8,H=5):te?(W=12,H=18):(W=5,H=8),Te(),e.preventDefault()}),_e.click(function(e){Xe(G=!1),e.preventDefault()}),$("#s_mascha").click(function(e){2<(z+=1)&&($(".t_mascha").removeClass("dn"),Ie&&localStorage.setItem("s_mascha","true"))}),$("#s_grrd").click(function(e){5<(B+=1)&&($(".t_shrek").removeClass("dn"),$("#favicon").attr("href","Images/favicon_dark.ico"),Ie&&localStorage.setItem("s_shrek","true"))}),$("#bt_settings").click(function(e){K||(K=!0,$("#t_europe").attr("src","Images/europe/theme.png"),$("#t_asia").attr("src","Images/asia/theme.png"),$("#t_america").attr("src","Images/america/theme.png"),$("#t_animals").attr("src","Images/animals/theme.png"),$("#t_flowers").attr("src","Images/flowers/theme.png"),$("#t_tricky").attr("src","Images/tricky/theme.png"),$("#t_mascha").attr("src","Images/mascha/theme.png"),$("#t_mascha2").attr("src","Images/mascha2/theme.png"),$("#t_mascha3").attr("src","Images/mascha3/theme.png"),$("#t_shrek").attr("src","Images/shrek/theme.png"))}),ye.click(function(e){ze("flowers"),$("#popupNewTheme").popup("close"),e.preventDefault()}),Pe.find("a").click(function(e){ze(this.children[0].getAttribute("alt")),Pe.popup("close"),e.preventDefault()}),Pe.css({"overflow-y":"auto","min-width":"270px"}),me.slider(),Ie?(null===localStorage.getItem("s_back_g_grid")?ie.val("on"):ie.val(localStorage.getItem("s_back_g_grid")),null===localStorage.getItem("s_backg_image")?ge.val("on"):ge.val(localStorage.getItem("s_backg_image")),null===localStorage.getItem("s_rotate")?re.val("off"):re.val(localStorage.getItem("s_rotate")),null===localStorage.getItem("s_sound")?le.val("on"):le.val(localStorage.getItem("s_sound")),null===localStorage.getItem("s_gold")?Ce("off"):Ce(localStorage.getItem("s_gold")),null===localStorage.getItem("s_theme")?ze("animals"):ze(localStorage.getItem("s_theme"))):(ie.val("on"),ge.val("on"),re.val("off"),le.val("on"),Ce("off"),ze("animals")),("true"===(e=Ke("mascha"))||Ie&&"true"===localStorage.getItem("s_mascha"))&&($(".t_mascha").removeClass("dn"),Ie&&localStorage.setItem("s_mascha","true")),("true"===(e=Ke("shrek"))||Ie&&"true"===localStorage.getItem("s_shrek"))&&($(".t_shrek").removeClass("dn"),$("#favicon").attr("href","Images/favicon_dark.ico"),Ie&&localStorage.setItem("s_shrek","true")),(e=Ke("theme"))&&ze(e),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(he.attr("style","display:none;"),fe.attr("style","display:none;")),$("#popupSettings").find("label").attr("style","display:inline;"),Me(),setTimeout(function(){Me()},500))},$(window).resize(function(){Me()}),navigator.sayswho=(T=navigator.appName,S=navigator.userAgent,A=S.match(/version\/([.\d]+)/i),(R=S.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i))&&null!==A&&(R[2]=A[1]),R=R?[R[1],R[2]]:[T,navigator.appVersion,"-?"]),document.webL10n.ready(function(){E=!0,(e=Ke("lang"))&&e!==document.webL10n.getLanguage()&&(document.webL10n.setLanguage(e),E=!1)}),document.addEventListener("localized",function(){E&&($("html").attr("lang",document.webL10n.getLanguage().substr(0,2)),$("meta[name=description]").attr("content",document.webL10n.get("lb_desc")),$("link[rel=manifest]").attr("href","Manifest/appmanifest_"+document.webL10n.getLanguage().substr(0,2)+".json"),$("link[rel=canonical]").attr("href","https://grrd01.github.io/Puzzle/?lang="+document.webL10n.getLanguage().substr(0,2)),$("#select_theme").html(document.webL10n.get("lb_"+s)),$("#radio0-1").attr("title",document.webL10n.get("lb_image")),$("#radio-offline").attr("title",document.webL10n.get("lb_image")),$(".image0").attr("alt",document.webL10n.get("lb_image")),setTimeout(function(){new Date("10/25/2014")>new Date&&"flowers"!==s&&Ie&&"flowers"!==localStorage.getItem("s_new_theme")&&(ye.popup("open"),Me(),setTimeout(function(){Me()},500))},500)),E=!0})}();