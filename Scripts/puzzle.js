/*
* grrd's Puzzle
* Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
* Licensed under the MPL License
*/

!function(){"use strict";var e,i,a,t,o,n,g,s,r,l,p,w,c,u,d,m,h,f,b,v,P,_,y,I,x,k,D,T,A,R,S,C=!!window.HTMLCanvasElement,L=new Kinetic.Layer({name:"g_layer"}),M=new Kinetic.Layer({name:"g_back_g_layer"}),X=new Kinetic.Stage({container:"container",width:document.getElementById("container").width,height:document.getElementById("container").height}),Y=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),E=!1,z=0,B=1,K=new Image,O="",F=4,j=6,W=15,H=0,N=!1,U=!1,Z=!1,G=!0,V=!0,q=!0,J=!0,Q=!1,ee=!0,te=!0,ae=!1,oe=$("#select_theme_img"),ne=$("#b_back_g_grid"),ie=$("#b_back_g_image"),ge=$("#b_rotate"),se=$("#b_sound"),re=$("#container"),le=$("#b_gold"),ce=$("#b_gold_enabled"),ue=$("#b_gold_disabled"),de=$("#b_prev"),me=$("#b_next"),he=$("#bt_easy"),fe=$("#bt_med"),be=$("#bt_hard"),ve=$("#bt_close"),pe=$("#b_image_input"),we=$("#popupTheme"),Pe=$("#popupNewTheme"),_e=function(){var e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function ye(){N=!(U=!0)}function $e(){var t;$.mobile.hidePageLoadingMsg(),$.mobile.changePage("#game",{transition:"slide"}),setTimeout(function(){var e=L.getChildren();for(t=0;t<e.length;t+=1)e[t].setZIndex(Math.floor(Math.random()*j*F));for(t=0;t<e.length;t+=1)Z?new Kinetic.Tween({node:e[t],x:Math.floor(Math.random()*x*(j-1))+x/2,y:Math.floor(Math.random()*k*(F-1))+k/2,rotation:.5*Math.PI*Math.floor(4*Math.random()),duration:1,onFinish:ye()}).play():new Kinetic.Tween({node:e[t],x:Math.floor(Math.random()*x*(j-1))+x/2,y:Math.floor(Math.random()*k*(F-1))+k/2,duration:1,onFinish:ye()}).play()},2e3)}function Ie(a,o,n,i){!function(){var t;if(G){var e=new Kinetic.Shape({drawFunc:function(e){e.beginPath(),e.moveTo(y,I),0===o?e.lineTo(y+x,I):(e.bezierCurveTo(y+.8*x,I+.1*k*n,y,I-.25*k*n,y+x/2,I-.25*k*n),e.bezierCurveTo(y+x,I-.25*k*n,y+.2*x,I+.1*k*n,y+x,I)),a===j-1?e.lineTo(y+x,I+k):(e.bezierCurveTo(y+x+.1*x*n,I+.8*k,y+x-.25*x*n,I,y+x-.25*x*n,I+k/2),e.bezierCurveTo(y+x-.25*x*n,I+k,y+x+.1*x*n,I+.2*k,y+x,I+k)),o===F-1?e.lineTo(y,I+k):(e.bezierCurveTo(y+.2*x,I+k-.1*k*n,y+x,I+k+.25*k*n,y+x/2,I+k+.25*k*n),e.bezierCurveTo(y,I+k+.25*k*n,y+.8*x,I+k-.1*k*n,y,I+k)),0===a?e.lineTo(y,I):(e.bezierCurveTo(y-.1*x*n,I+.2*k,y+.25*x*n,I+k,y+.25*x*n,I+k/2),e.bezierCurveTo(y+.25*x*n,I,y-.1*x*n,I+.8*k,y,I)),e.closePath(),e.fillStrokeShape(this)},fillPatternImage:i,fillPatternOffset:[a*x,o*k],stroke:"black",strokeWidth:4});e.toImage({width:x+.6*x,height:k+.6*k,x:.3*-x,y:.3*-k,callback:function(e){Me(t=new Kinetic.Image({image:e,x:a*x+x/2,origX:a*x+x/2,y:o*k+k/2,origY:o*k+k/2,row:o,col:a,offset:[x/2+.3*x,k/2+.3*k],draggable:!0,dragBoundFunc:function(e){var t=e.y,a=e.x;return a<0&&(a=0),p<a&&(a=p),t<0&&(t=0),w<t&&(t=w),{x:a,y:t}},name:"part_z"+o+"_s"+a})),t.createImageHitRegion(function(){L.drawHit()})}}),e.setStrokeWidth(null),e.setStroke(null),e.toImage({width:x+.6*x,height:k+.6*k,x:.3*-x,y:.3*-k,callback:function(e){b[o][a]=e}})}else Me(t=new Kinetic.Image({x:a*x+x/2,origX:a*x+x/2,y:o*k+k/2,origY:o*k+k/2,row:o,col:a,width:x,height:k,offset:[x/2,k/2],crop:{x:i.width/j*a,y:i.height/F*o,width:i.width/j,height:i.height/F},stroke:"black",strokeWidth:4,fill:"black",Image:i,draggable:!0,dragBoundFunc:function(e){var t=e.y,a=e.x;return a<0&&(a=0),p<a&&(a=p),t<0&&(t=0),w<t&&(t=w),{x:a,y:t}},name:"part_z"+o+"_s"+a}))}()}function xe(){var t,a;for(b=[],t=0;t<F;t+=1)b[t]=[];H=0,L.removeChildren(),M.removeChildren(),X.removeChildren(),X.setWidth(p),X.setHeight(w),I=y=0,x=p/j,k=w/F,1,X.add(L);var e=p,o=w;Y&&(o/=function(e,t){var a=document.createElement("canvas");a.width=1,a.height=t;var o=a.getContext("2d");o.drawImage(e,0,0);for(var n=o.getImageData(0,0,1,t).data,i=0,g=t,s=t;i<s;)0===n[4*(s-1)+3]?g=s:i=s,s=g+i>>1;var r=s/t;return 0===r?1:r}(K,K.naturalHeight));0!==D.getPos()||5!==s&&6!==s&&7!==s&&8!==s||(e=w,o=p);var n=new Kinetic.Image({width:e,height:o,crop:{x:0,y:0,width:K.width,height:K.height},Image:K});0!==D.getPos()||5!==s&&6!==s||(n.setRotationDeg(90),n.setX(p)),0!==D.getPos()||3!==s&&4!==s||(n.setRotationDeg(180),n.setX(p),n.setY(w)),0!==D.getPos()||7!==s&&8!==s||(n.setRotationDeg(270),n.setY(w)),n.toImage({width:p,height:w,callback:function(e){if((V||q)&&function(e){var t,a,o,n;if(q&&(t=new Kinetic.Image({x:0,y:0,width:p,height:w,Image:e,opacity:.1}),M.add(t),M.draw()),V)for(a=0;a<F;a+=1)for(o=0;o<j;o+=1)n=new Kinetic.Rect({x:o*x,y:a*k,width:x,height:k,stroke:"#333333",strokeWidth:2}),M.add(n);X.add(M),M.moveToBottom()}(e),G)n.toImage({width:p,height:w,callback:function(e){for(a=0;a<F;a+=1)for(t=0;t<j;t+=1)Ie(t,a,a%2!=0&&t%2!=0||a%2==0&&t%2==0?1:-1,e);L.draw(),$e()}});else{for(a=0;a<F;a+=1)for(t=0;t<j;t+=1)Ie(t,a,a%2!=0&&t%2!=0||a%2==0&&t%2==0?1:-1,e);L.draw(),$e()}}})}function ke(){P=D.getPos(),v=$("input:radio[name=image-set-"+P+"]:checked").val(),N||(void 0!==v&&(void 0!==o||0!==P)?ee&&$("#image"+P+"-"+v).hasClass("locked")||(N=!0,$.mobile.showPageLoadingMsg("a",document.webL10n.get("lb_load"),!1),V="on"===ne.val(),q="on"===ie.val(),Z="on"===ge.val(),J="on"===se.val(),_e&&(localStorage.setItem("s_back_g_grid",ne.val()),localStorage.setItem("s_backg_image",ie.val()),localStorage.setItem("s_rotate",ge.val()),localStorage.setItem("s_sound",se.val())),document.getElementById("container").width=r,document.getElementById("container").height=l,w=l-4,p=r,u=O,0!==P?(g=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,n=Math.min(l,r)*g<=270?"s":1080<Math.min(l,r)*g?"l":"",t="Images/"+i+"/image-set-"+P+"/sujet"+O+v+n+".jpg"):t=o,$("#g_imageObj").one("load",function(){K=document.getElementById("g_imageObj"),xe()}).attr("src",t).each(function(){0<=navigator.sayswho.indexOf("MSIE")&&this.complete&&$(this).trigger("load")})):$("#popup_choose").popup("open"))}function De(e,t,a,o){var n,i,g,s,r,l,c;if("g_layer"===e.getParent().attrs.name)if("g_layer"===t.getParent().attrs.name){t.setX(a),t.setY(o);var u=new Kinetic.Group({draggable:!0,dragBoundFunc:function(e){var t=e.y,a=e.x;return a<0&&(a=0),p<a&&(a=p),t<0&&(t=0),w<t&&(t=w),{x:a,y:t}}});e.moveTo(u),t.moveTo(u),e.setDraggable(!1),t.setDraggable(!1),L.add(u)}else s=e.getX(),r=e.getY(),t.getParent().setX(t.getParent().getX()+a-t.getAbsolutePosition().x),t.getParent().setY(t.getParent().getY()+o-t.getAbsolutePosition().y),e.moveTo(t.getParent()),e.setRotationDeg(t.getRotationDeg()),l=s-e.getAbsolutePosition().x,c=r-e.getAbsolutePosition().y,0===e.getParent().getRotationDeg()&&(e.setX(e.getX()+l),e.setY(e.getY()+c)),90===e.getParent().getRotationDeg()&&(e.setY(e.getY()-l),e.setX(e.getX()+c)),180===e.getParent().getRotationDeg()&&(e.setX(e.getX()-l),e.setY(e.getY()-c)),270===e.getParent().getRotationDeg()&&(e.setY(e.getY()+l),e.setX(e.getX()-c)),e.setDraggable(!1);else if("g_layer"===t.getParent().attrs.name)t.moveTo(e.getParent()),t.setAbsolutePosition(a,o),t.setRotationDeg(e.getRotationDeg()),t.setDraggable(!1);else{i=t.getParent().getChildren();for(var d=a-t.getAbsolutePosition().x,m=o-t.getAbsolutePosition().y;0<i.length;)void 0!==i[0]&&(s=(g=i[0]).getAbsolutePosition().x,r=g.getAbsolutePosition().y,g.moveTo(e.getParent()),g.setRotationDeg(e.getRotationDeg()),l=s-g.getAbsolutePosition().x+d,c=r-g.getAbsolutePosition().y+m,0===e.getParent().getRotationDeg()&&(g.setX(g.getX()+l),g.setY(g.getY()+c)),90===e.getParent().getRotationDeg()&&(g.setY(g.getY()-l),g.setX(g.getX()+c)),180===e.getParent().getRotationDeg()&&(g.setX(g.getX()-l),g.setY(g.getY()-c)),270===e.getParent().getRotationDeg()&&(g.setY(g.getY()+l),g.setX(g.getX()-c)))}var h=(i=e.getParent().getChildren())[0].getAbsolutePosition().x,f=i[0].getAbsolutePosition().x,b=i[0].getAbsolutePosition().y,v=i[0].getAbsolutePosition().y;for(n=0;n<i.length;n+=1)i[n].getAbsolutePosition().x<h&&(h=i[n].getAbsolutePosition().x),i[n].getAbsolutePosition().x>f&&(f=i[n].getAbsolutePosition().x),i[n].getAbsolutePosition().y<b&&(b=i[n].getAbsolutePosition().y),i[n].getAbsolutePosition().y>v&&(v=i[n].getAbsolutePosition().y);s=e.getAbsolutePosition().x,r=e.getAbsolutePosition().y,e.getParent().setOffset(0,0),e.getParent().setX((h+f)/2),e.getParent().setY((b+v)/2),l=s-e.getAbsolutePosition().x,c=r-e.getAbsolutePosition().y,0===e.getParent().getRotationDeg()&&e.getParent().setOffset(-1*l,-1*c),90===e.getParent().getRotationDeg()&&e.getParent().setOffset(-1*c,l),180===e.getParent().getRotationDeg()&&e.getParent().setOffset(l,c),270===e.getParent().getRotationDeg()&&e.getParent().setOffset(c,-1*l),"g_layer"===t.getParent().attrs.name?t.moveToTop():t.getParent().moveToTop(),L.draw(),J&&document.getElementById("click_sound").play()}function Te(e){var t,a,o,n,i=[-1,1,0,0],g=[0,0,-1,1];for(m="g_layer"===e.getParent().attrs.name?e.getRotationDeg():(e.getRotationDeg()+e.getParent().getRotationDeg())%360,t=0;t<i.length;t+=1)0<(n=X.get(".part_z"+(e.attrs.row+g[t])+"_s"+(e.attrs.col+i[t]))).length&&(h="g_layer"===n[0].getParent().attrs.name?n[0].getRotationDeg():(n[0].getRotationDeg()+n[0].getParent().getRotationDeg())%360,0===m&&(a=e.getAbsolutePosition().x+x*i[t],o=e.getAbsolutePosition().y+k*g[t]),90===m&&(a=e.getAbsolutePosition().x-k*g[t],o=e.getAbsolutePosition().y+x*i[t]),180===m&&(a=e.getAbsolutePosition().x-x*i[t],o=e.getAbsolutePosition().y-k*g[t]),270===m&&(a=e.getAbsolutePosition().x+k*g[t],o=e.getAbsolutePosition().y-x*i[t]),Math.abs(a-n[0].getAbsolutePosition().x)<W&&Math.abs(o-n[0].getAbsolutePosition().y)<W&&m===h&&("g_layer"===e.getParent().attrs.name||"g_layer"===n[0].getParent().attrs.name||e.getParent()!==n[0].getParent())&&De(e,n[0],a,o))}function Ae(e){void 0!==e&&(e.setX(e.attrs.origX),e.setY(e.attrs.origY),e.setRotationDeg(0),e.moveToBottom(),e.setStrokeWidth(null),e.setStroke(null),e.setDraggable(!1),G&&e.setImage(b[e.attrs.row][e.attrs.col]),L.draw(),G&&e.disableShadow(),J&&document.getElementById("click_sound").play(),document.body.style.cursor="default",setTimeout(function(){(H+=1)===j*F&&(ve.css("display","none"),J&&document.getElementById("ding_sound").play())},500))}function Re(e){le.val(e).slider("refresh"),_e&&localStorage.setItem("s_gold",le.val()),"on"===le.val()?(Q=!0,$("#img_easy").attr("src","Images/easy_gold.svg"),$("#img_med").attr("src","Images/medium_gold.svg"),$("#img_hard").attr("src","Images/hard_gold.svg")):(Q=!1,$("#img_easy").attr("src","Images/easy.svg"),$("#img_med").attr("src","Images/medium.svg"),$("#img_hard").attr("src","Images/hard.svg"))}function Se(){var e,t,a,o,n=0;for(e=1;e<5;e+=1)for(t=1;t<4;t+=1)a=_e&&localStorage.getItem(i+e+O+t)||0,n+=parseInt(a),ee?0<a?((o=$("#medal"+e+"-"+t)).removeClass("dn"),o.attr("src","Images/medal"+a+".svg"),t<3&&($("#image"+e+"-"+(t+1)).removeClass("locked"),$("#lock"+e+"-"+(t+1)).addClass("dn"))):($("#medal"+e+"-"+t).addClass("dn"),t<3&&($("#image"+e+"-"+(t+1)).addClass("locked"),$("#lock"+e+"-"+(t+1)).removeClass("dn"))):($("#medal"+e+"-"+t).addClass("dn"),$("#image"+e+"-"+(t+1)).removeClass("locked"),$("#lock"+e+"-"+(t+1)).addClass("dn"));36===n?(ce.show(),Re("on"),le.slider({theme:"d"}).slider("refresh"),ue.hide()):(ue.show(),Re("off"),le.slider({theme:"d"}).slider("refresh"),ce.hide())}function Ce(){var e,t;if(l=$(window).height(),r=$(window).width(),O="",r<l?(O="p",$("#img_title").attr("style","width:100%;"),$(".image0").attr("style","height:"+1.5*(r/3-50)+"px;"),$(".lock").css({left:"10%",bottom:(r-70)/9.8,width:"80%"})):($("#img_title").attr("style","max-height:"+l/5+"px;"),$(".image0").attr("style","height:"+(r/3-50)/1.5+"px;"),$(".lock").css({left:"25%",bottom:(r-70)/30,width:"50%"})),we.css("max-height",l-10+"px"),Pe.css("max-width",r-10+"px"),he.attr("style","width:"+(r/3-12)+"px;"),fe.attr("style","width:"+(r/3-12)+"px;"),be.attr("style","width:"+(r/3-12)+"px;"),navigator.onLine){for(e=1;e<B+1;e+=1)for(t=1;t<4;t+=1)$("#radio"+e+"-"+t).attr("style","width:"+(r/3-12)+"px;"),$("#image"+e+"-"+t).attr("src","Images/"+i+"/image-set-"+e+"/sujet"+O+t+"s.jpg");$(".offline").hide(),$(".online").show()}else $(".offline").show(),$(".online").hide(),D.slide(0,0);i===a&&O===c||(a=i,c=O,Se())}function Le(e){var t;ve.css("display","inline"),e&&(t=_e&&localStorage.getItem(i+P+u+v)||0,parseInt(_)>parseInt(t)&&(_e&&localStorage.setItem(i+P+u+v,_),Se(),J&&document.getElementById("ding_sound").play())),$.mobile.changePage("#title",{transition:"slide",reverse:!0}),Ce(),setTimeout(function(){Ce()},500)}function Me(e){var t;e.on("mouseover",function(){(e.getDraggable()||e.getParent().getDraggable())&&U&&(document.body.style.cursor="pointer")}),e.on("click tap",function(){!1!==ae&&((e.getDraggable()||e.getParent().getDraggable())&&U&&Z&&d===L.getChildren().length-1?"g_layer"===e.getParent().attrs.name?(t=e.getRotation(),U=!1,new Kinetic.Tween({node:e,duration:.5,rotation:t+Math.PI/2,onFinish:function(){U=!0,360===e.getRotationDeg()&&e.setRotationDeg(0),e.fire("dragend")}}).play()):(t=e.getParent().getRotation(),U=!1,new Kinetic.Tween({node:e.getParent(),duration:.5,rotation:t+Math.PI/2,onFinish:function(){U=!0,360===e.getParent().getRotationDeg()&&e.getParent().setRotationDeg(0),e.fire("dragend")}}).play()):H===j*F?Le(!(U=!1)):e.fire("dragend"))}),e.on("mousedown touchstart",function(){ae=!0,setTimeout(function(){ae=!1},500),((f=e).getDraggable()||e.getParent().getDraggable())&&U&&("g_layer"===e.getParent().attrs.name?(d=e.getZIndex(),e.moveToTop()):(d=e.getParent().getZIndex(),e.getParent().moveToTop()))}),e.on("dragend",function(){(e.getDraggable()||e.getParent().getDraggable())&&U?function(e){var t,a,o;if(m="g_layer"===e.getParent().attrs.name?e.getRotationDeg():(e.getRotationDeg()+e.getParent().getRotationDeg())%360,Math.abs(e.getAbsolutePosition().x-e.attrs.origX)<W&&Math.abs(e.getAbsolutePosition().y-e.attrs.origY)<W&&0===m)if("g_layer"===e.getParent().attrs.name)Ae(e);else for(a=e.getParent().getChildren();0<a.length;)(o=a[0]).moveTo(L),Ae(o);else if("g_layer"===e.getParent().attrs.name)Te(e);else for(a=e.getParent().getChildren(),t=0;t<a.length;t+=1)Te(a[t])}(e):H===j*F&&Le(!(U=!1))}),e.on("mouseout",function(){document.body.style.cursor="default"}),L.add(e),L.draw(),X.draw()}function Xe(t){var e;if("Safari,5.1.7"!==navigator.sayswho&&"MSIE,9.0"!==navigator.sayswho){if((e=t.target.files[0]).type.match("image.*")){var a=new FileReader;a.onload=function(e){o=e.target.result,EXIF.getData(t.target.files[0],function(){s=EXIF.getTag(this,"Orientation")}),$(".image0").attr("src",o),Ce(),setTimeout(function(){Ce()},500)},a.readAsDataURL(e)}}else $("#popup_own_img").popup("open")}function Ye(e){i=e,oe.attr("src","Images/"+i+"/theme.png"),E&&$("#select_theme").html(document.webL10n.get("lb_"+i)),_e&&localStorage.setItem("s_theme",e),oe.attr("style","width:59px; float:left;"),Ce(),oe.attr("style","width:60px; float:left;")}function Ee(){0===D.getPos()?$("#bullets0").attr("src","Images/bullets1o.svg"):$("#bullets0").attr("src","Images/bullets0o.svg"),1===D.getPos()?$("#bullets1").attr("src","Images/bullets1.svg"):$("#bullets1").attr("src","Images/bullets0.svg"),2===D.getPos()?$("#bullets2").attr("src","Images/bullets1.svg"):$("#bullets2").attr("src","Images/bullets0.svg"),3===D.getPos()?$("#bullets3").attr("src","Images/bullets1.svg"):$("#bullets3").attr("src","Images/bullets0.svg"),4===D.getPos()?$("#bullets4").attr("src","Images/bullets1.svg"):$("#bullets4").attr("src","Images/bullets0.svg")}function ze(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null!==t&&t[1]}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){},function(e){})}),re.mouseup(function(){void 0!==f&&"g_layer"!==f.getParent().attrs.name&&setTimeout(function(){f.fire("dragend")},350)}),re.touchend(function(){void 0!==f&&"g_layer"!==f.getParent().attrs.name&&setTimeout(function(){f.fire("dragend")},350)}),$(".own_image").click(function(){"Safari,5.1.7"!==navigator.sayswho&&"MSIE,9.0"!==navigator.sayswho?"file"!==pe.attr("type")?window.MozActivity&&(new MozActivity({name:"pick",data:{type:"image/jpeg"}}).onsuccess=function(){o=window.URL.createObjectURL(this.result.blob),$(".image0").attr("src",o),Ce(),setTimeout(function(){Ce()},500)}):pe.click():$("#popup_own_img").popup("open")}).show(),le.on("change",function(){Re(le.val())}),window.onload=function(){te&&(te=!1,C||$("#popup_canvas").popup("open"),D=new Swipe(document.getElementById("image_slider"),{startSlide:1,callback:function(e,t){0===t?$("#bullets0").attr("src","Images/bullets1o.svg"):$("#bullets0").attr("src","Images/bullets0o.svg"),1===t?$("#bullets1").attr("src","Images/bullets1.svg"):$("#bullets1").attr("src","Images/bullets0.svg"),2===t?$("#bullets2").attr("src","Images/bullets1.svg"):$("#bullets2").attr("src","Images/bullets0.svg"),3===t?$("#bullets3").attr("src","Images/bullets1.svg"):$("#bullets3").attr("src","Images/bullets0.svg"),4===t?$("#bullets4").attr("src","Images/bullets1.svg"):$("#bullets4").attr("src","Images/bullets0.svg")}}),document.getElementById("b_image_input").addEventListener("change",Xe,!1),de.click(function(e){D.prev(),Ee(),e.preventDefault()}),me.click(function(e){D.next(),Ee(),e.preventDefault()}),he.click(function(e){_="1",r<l?Q?(F=9,j=6):(F=3,j=2):Q?(F=6,j=9):(F=2,j=3),ke(),e.preventDefault()}),fe.click(function(e){_="2",r<l?Q?(F=12,j=8):(F=6,j=4):Q?(F=8,j=12):(F=4,j=6),ke(),e.preventDefault()}),be.click(function(e){_="3",r<l?Q?(F=18,j=12):(F=8,j=5):Q?(F=12,j=18):(F=5,j=8),ke(),e.preventDefault()}),ve.click(function(e){Le(U=!1),e.preventDefault()}),$("#s_mascha").click(function(e){2<(z+=1)&&$(".t_mascha").removeClass("dn")}),Pe.click(function(e){Ye("flowers"),$("#popupNewTheme").popup("close"),e.preventDefault()}),we.find("a").click(function(e){Ye(this.children[0].getAttribute("alt")),we.popup("close"),e.preventDefault()}),we.css({"overflow-y":"auto","min-width":"270px"}),le.slider(),_e?(null===localStorage.getItem("s_back_g_grid")?ne.val("on"):ne.val(localStorage.getItem("s_back_g_grid")),null===localStorage.getItem("s_backg_image")?ie.val("on"):ie.val(localStorage.getItem("s_backg_image")),null===localStorage.getItem("s_rotate")?ge.val("off"):ge.val(localStorage.getItem("s_rotate")),null===localStorage.getItem("s_sound")?se.val("on"):se.val(localStorage.getItem("s_sound")),null===localStorage.getItem("s_gold")?Re("off"):Re(localStorage.getItem("s_gold")),null===localStorage.getItem("s_theme")?Ye("animals"):Ye(localStorage.getItem("s_theme"))):(ne.val("on"),ie.val("on"),ge.val("off"),se.val("on"),Re("off"),Ye("animals")),"true"===(e=ze("mascha"))&&$(".t_mascha").removeClass("dn"),"true"===(e=ze("shrek"))&&($(".t_shrek").removeClass("dn"),$("#favicon").attr("href","Images/favicon_dark.ico")),(e=ze("theme"))&&Ye(e),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(de.attr("style","display:none;"),me.attr("style","display:none;")),$("#popupSettings").find("label").attr("style","display:inline;"),Ce(),setTimeout(function(){B=4,Ce()},500))},$(window).resize(function(){Ce()}),navigator.sayswho=(T=navigator.appName,A=navigator.userAgent,R=A.match(/version\/([.\d]+)/i),(S=A.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i))&&null!==R&&(S[2]=R[1]),S=S?[S[1],S[2]]:[T,navigator.appVersion,"-?"]),document.webL10n.ready(function(){E=!0,(e=ze("lang"))&&e!==document.webL10n.getLanguage()&&(document.webL10n.setLanguage(e),E=!1)}),document.addEventListener("localized",function(){E&&($("html").attr("lang",document.webL10n.getLanguage().substr(0,2)),$("meta[name=description]").attr("content",document.webL10n.get("lb_desc")),$("link[rel=manifest]").attr("href","Manifest/appmanifest_"+document.webL10n.getLanguage().substr(0,2)+".json"),$("link[rel=canonical]").attr("href","https://grrd01.github.io/Puzzle/?lang="+document.webL10n.getLanguage().substr(0,2)),$("#select_theme").html(document.webL10n.get("lb_"+i)),$("#radio0-1").attr("title",document.webL10n.get("lb_image")),$("#radio-offline").attr("title",document.webL10n.get("lb_image")),$(".image0").attr("alt",document.webL10n.get("lb_image")),setTimeout(function(){new Date("10/25/2014")>new Date&&"flowers"!==i&&_e&&"flowers"!==localStorage.getItem("s_new_theme")&&(Pe.popup("open"),Ce(),setTimeout(function(){Ce()},500))},500)),E=!0})}();