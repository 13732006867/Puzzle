/**
 * grrd's Puzzle
 * Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";var e,t,n,o,a,s,i,r,l,g,c,d,m,u,f,h,b,v,y,_,w,p,P,I,k,L,E,S,A,T,D,x=!!window.HTMLCanvasElement,R=new Kinetic.Layer({name:"g_layer"}),C=new Kinetic.Layer({name:"g_back_g_layer"}),M=new Kinetic.Stage({container:"container",width:document.getElementById("container").width,height:document.getElementById("container").height}),F=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),B=!1,X=0,Y=0,z=!1,H=2,N=new Image,K="",q=4,O=6,W=15,j=0,U=!1,Z=!1,G=!1,V=!0,J=!0,Q=!0,$=!0,ee=!1,te=!0,ne=!0,oe=!1,ae=function(e){return document.getElementById(e)},se=ae("select_theme_img"),ie=ae("b_back_g_grid"),re=ae("b_back_g_image"),le=ae("b_rotate"),ge=ae("b_sound"),ce=ae("container"),de=ae("b_gold"),me=ae("b_gold_enabled"),ue=ae("b_gold_disabled"),fe=ae("b_prev"),he=ae("b_next"),be=ae("bt_easy"),ve=ae("bt_med"),ye=ae("bt_hard"),_e=ae("bt_close"),we=ae("b_image_input"),pe=ae("iPopupInfo"),Pe=ae("iPopupSettings"),Ie=ae("iFullscreen"),ke=ae("iPopupHelp"),Le=ae("img_help"),Ee=ae("lb_help"),Se=ae("game"),Ae=ae("title"),Te=function(){var e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();function De(e){e.classList.remove("popup-init"),e.classList.remove("popup-hide"),e.classList.add("popup-show")}function xe(e){e.classList.remove("popup-show"),e.classList.add("popup-hide"),setTimeout((function(){e.scrollTop=0}),1050)}function Re(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?ae("img_fullscreen").src="Images/escfullscreen.svg":ae("img_fullscreen").src="Images/fullscreen.svg"}function Ce(){Z=!0,U=!1}function Me(){var e;xe(ke),setTimeout((function(){ae("iCloseHelp").classList.remove("dn"),Le.style.height=null,Le.style.padding=null}),500),Ae.classList.remove("swipe-out-right"),Se.classList.remove("swipe-in-left"),Ae.classList.add("swipe-out"),Se.classList.add("swipe-in"),setTimeout((function(){var t=R.getChildren();for(e=0;e<t.length;e+=1)t[e].setZIndex(Math.floor(Math.random()*O*q));for(e=0;e<t.length;e+=1)G?new Kinetic.Tween({node:t[e],x:Math.floor(Math.random()*k*(O-1))+k/2,y:Math.floor(Math.random()*L*(q-1))+L/2,rotation:.5*Math.PI*Math.floor(4*Math.random()),duration:1,onFinish:Ce()}).play():new Kinetic.Tween({node:t[e],x:Math.floor(Math.random()*k*(O-1))+k/2,y:Math.floor(Math.random()*L*(q-1))+L/2,duration:1,onFinish:Ce()}).play()}),2e3)}function Fe(e,t,n,o){!function(){var a;if(V){var s=new Kinetic.Shape({drawFunc:function(o){o.beginPath(),o.moveTo(P,I),0===t?o.lineTo(P+k,I):(o.bezierCurveTo(P+.8*k,I+.1*L*n,P,I-.25*L*n,P+k/2,I-.25*L*n),o.bezierCurveTo(P+k,I-.25*L*n,P+.2*k,I+.1*L*n,P+k,I)),e===O-1?o.lineTo(P+k,I+L):(o.bezierCurveTo(P+k+.1*k*n,I+.8*L,P+k-.25*k*n,I,P+k-.25*k*n,I+L/2),o.bezierCurveTo(P+k-.25*k*n,I+L,P+k+.1*k*n,I+.2*L,P+k,I+L)),t===q-1?o.lineTo(P,I+L):(o.bezierCurveTo(P+.2*k,I+L-.1*L*n,P+k,I+L+.25*L*n,P+k/2,I+L+.25*L*n),o.bezierCurveTo(P,I+L+.25*L*n,P+.8*k,I+L-.1*L*n,P,I+L)),0===e?o.lineTo(P,I):(o.bezierCurveTo(P-.1*k*n,I+.2*L,P+.25*k*n,I+L,P+.25*k*n,I+L/2),o.bezierCurveTo(P+.25*k*n,I,P-.1*k*n,I+.8*L,P,I)),o.closePath(),o.fillStrokeShape(this)},fillPatternImage:o,fillPatternOffset:[e*k,t*L],stroke:"black",strokeWidth:4});s.toImage({width:k+.6*k,height:L+.6*L,x:.3*-k,y:.3*-L,callback:function(n){We(a=new Kinetic.Image({image:n,x:e*k+k/2,origX:e*k+k/2,y:t*L+L/2,origY:t*L+L/2,row:t,col:e,offset:[k/2+.3*k,L/2+.3*L],draggable:!0,dragBoundFunc:function(e){var t=e.y,n=e.x;return n<0&&(n=0),n>c&&(n=c),t<0&&(t=0),t>d&&(t=d),{x:n,y:t}},name:"part_z"+t+"_s"+e})),a.createImageHitRegion((function(){R.drawHit()}))}}),s.setStrokeWidth(null),s.setStroke(null),s.toImage({width:k+.6*k,height:L+.6*L,x:.3*-k,y:.3*-L,callback:function(n){y[t][e]=n}})}else We(a=new Kinetic.Image({x:e*k+k/2,origX:e*k+k/2,y:t*L+L/2,origY:t*L+L/2,row:t,col:e,width:k,height:L,offset:[k/2,L/2],crop:{x:o.width/O*e,y:o.height/q*t,width:o.width/O,height:o.height/q},stroke:"black",strokeWidth:4,fill:"black",Image:o,draggable:!0,dragBoundFunc:function(e){var t=e.y,n=e.x;return n<0&&(n=0),n>c&&(n=c),t<0&&(t=0),t>d&&(t=d),{x:n,y:t}},name:"part_z"+t+"_s"+e}))}()}function Be(){var e,t;for(y=[],e=0;e<q;e+=1)y[e]=[];j=0,R.removeChildren(),C.removeChildren(),M.removeChildren(),M.setWidth(c),M.setHeight(d),P=0,I=0,k=c/O,L=d/q,1,M.add(R);var n=c,o=d;F&&(o/=function(e,t){var n=document.createElement("canvas");n.width=1,n.height=t;var o=n.getContext("2d");o.drawImage(e,0,0);for(var a=o.getImageData(0,0,1,t).data,s=0,i=t,r=t;r>s;)0===a[4*(r-1)+3]?i=r:s=r,r=i+s>>1;var l=r/t;return 0===l?1:l}(N,N.naturalHeight));0!==E.getPos()||5!==r&&6!==r&&7!==r&&8!==r||(n=d,o=c);var a=new Kinetic.Image({width:n,height:o,crop:{x:0,y:0,width:N.width,height:N.height},Image:N});0!==E.getPos()||5!==r&&6!==r||(a.setRotationDeg(90),a.setX(c)),0!==E.getPos()||3!==r&&4!==r||(a.setRotationDeg(180),a.setX(c),a.setY(d)),0!==E.getPos()||7!==r&&8!==r||(a.setRotationDeg(270),a.setY(d)),a.toImage({width:c,height:d,callback:function(n){if((J||Q)&&function(e){var t,n,o,a;if(Q&&(t=new Kinetic.Image({x:0,y:0,width:c,height:d,Image:e,opacity:.1}),C.add(t),C.draw()),J)for(n=0;n<q;n+=1)for(o=0;o<O;o+=1)a=new Kinetic.Rect({x:o*k,y:n*L,width:k,height:L,stroke:"#333333",strokeWidth:2}),C.add(a);M.add(C),C.moveToBottom()}(n),V)a.toImage({width:c,height:d,callback:function(n){for(t=0;t<q;t+=1)for(e=0;e<O;e+=1)Fe(e,t,t%2!=0&&e%2!=0||t%2==0&&e%2==0?1:-1,n);R.draw(),Me()}});else{for(t=0;t<q;t+=1)for(e=0;e<O;e+=1)Fe(e,t,t%2!=0&&e%2!=0||t%2==0&&e%2==0?1:-1,n);R.draw(),Me()}}})}function Xe(){if(w=E.getPos(),_=parseInt(ae("nav"+w).getElementsByClassName("selected")[0].getAttribute("data-num"),10),!U)return void 0===_||void 0===a&&0===w?(Le.src="Images/photo.svg",Ee.innerHTML=document.webL10n.get("lb_choose"),void De(ke)):void(w>0&&te&&ae("image"+w+"-"+_).classList.contains("locked")||(U=!0,Le.src="Images/loading.svg",Le.style.height="70px",Le.style.padding="5px",Ee.innerHTML=document.webL10n.get("lb_load"),ae("iCloseHelp").classList.add("dn"),De(ke),J=ie.checked,Q=re.checked,G=le.checked,$=ge.checked,Te&&(localStorage.setItem("s_back_g_grid",ie.checked?"on":"off"),localStorage.setItem("s_backg_image",re.checked?"on":"off"),localStorage.setItem("s_rotate",le.checked?"on":"off"),localStorage.setItem("s_sound",ge.checked?"on":"off")),document.getElementById("container").width=l,document.getElementById("container").height=g,d=g,c=l,u=K,0!==w?(i=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,s=Math.min(g,l)*i<=270?"s":Math.min(g,l)*i>1080?"l":"",o="Images/"+t+"/image-set-"+w+"/sujet"+K+_+s+".jpg"):o=a,N.addEventListener("load",Be),N.src=o))}function Ye(e,t,n,o){var a,s,i,r,l,g,m;if("g_layer"===e.getParent().attrs.name)if("g_layer"===t.getParent().attrs.name){t.setX(n),t.setY(o);var u=new Kinetic.Group({draggable:!0,dragBoundFunc:function(e){var t=e.y,n=e.x;return n<0&&(n=0),n>c&&(n=c),t<0&&(t=0),t>d&&(t=d),{x:n,y:t}}});e.moveTo(u),t.moveTo(u),e.setDraggable(!1),t.setDraggable(!1),R.add(u)}else r=e.getX(),l=e.getY(),t.getParent().setX(t.getParent().getX()+n-t.getAbsolutePosition().x),t.getParent().setY(t.getParent().getY()+o-t.getAbsolutePosition().y),e.moveTo(t.getParent()),e.setRotationDeg(t.getRotationDeg()),g=r-e.getAbsolutePosition().x,m=l-e.getAbsolutePosition().y,0===e.getParent().getRotationDeg()&&(e.setX(e.getX()+g),e.setY(e.getY()+m)),90===e.getParent().getRotationDeg()&&(e.setY(e.getY()-g),e.setX(e.getX()+m)),180===e.getParent().getRotationDeg()&&(e.setX(e.getX()-g),e.setY(e.getY()-m)),270===e.getParent().getRotationDeg()&&(e.setY(e.getY()+g),e.setX(e.getX()-m)),e.setDraggable(!1);else if("g_layer"===t.getParent().attrs.name)t.moveTo(e.getParent()),t.setAbsolutePosition(n,o),t.setRotationDeg(e.getRotationDeg()),t.setDraggable(!1);else{s=t.getParent().getChildren();for(var f=n-t.getAbsolutePosition().x,h=o-t.getAbsolutePosition().y;s.length>0;)void 0!==s[0]&&(r=(i=s[0]).getAbsolutePosition().x,l=i.getAbsolutePosition().y,i.moveTo(e.getParent()),i.setRotationDeg(e.getRotationDeg()),g=r-i.getAbsolutePosition().x+f,m=l-i.getAbsolutePosition().y+h,0===e.getParent().getRotationDeg()&&(i.setX(i.getX()+g),i.setY(i.getY()+m)),90===e.getParent().getRotationDeg()&&(i.setY(i.getY()-g),i.setX(i.getX()+m)),180===e.getParent().getRotationDeg()&&(i.setX(i.getX()-g),i.setY(i.getY()-m)),270===e.getParent().getRotationDeg()&&(i.setY(i.getY()+g),i.setX(i.getX()-m)))}var b=(s=e.getParent().getChildren())[0].getAbsolutePosition().x,v=s[0].getAbsolutePosition().x,y=s[0].getAbsolutePosition().y,_=s[0].getAbsolutePosition().y;for(a=0;a<s.length;a+=1)s[a].getAbsolutePosition().x<b&&(b=s[a].getAbsolutePosition().x),s[a].getAbsolutePosition().x>v&&(v=s[a].getAbsolutePosition().x),s[a].getAbsolutePosition().y<y&&(y=s[a].getAbsolutePosition().y),s[a].getAbsolutePosition().y>_&&(_=s[a].getAbsolutePosition().y);r=e.getAbsolutePosition().x,l=e.getAbsolutePosition().y,e.getParent().setOffset(0,0),e.getParent().setX((b+v)/2),e.getParent().setY((y+_)/2),g=r-e.getAbsolutePosition().x,m=l-e.getAbsolutePosition().y,0===e.getParent().getRotationDeg()&&e.getParent().setOffset(-1*g,-1*m),90===e.getParent().getRotationDeg()&&e.getParent().setOffset(-1*m,g),180===e.getParent().getRotationDeg()&&e.getParent().setOffset(g,m),270===e.getParent().getRotationDeg()&&e.getParent().setOffset(m,-1*g),"g_layer"===t.getParent().attrs.name?t.moveToTop():t.getParent().moveToTop(),R.draw(),$&&document.getElementById("click_sound").play()}function ze(e){var t,n,o,a,s=[-1,1,0,0],i=[0,0,-1,1];for(h="g_layer"===e.getParent().attrs.name?e.getRotationDeg():(e.getRotationDeg()+e.getParent().getRotationDeg())%360,t=0;t<s.length;t+=1)(a=M.get(".part_z"+(e.attrs.row+i[t])+"_s"+(e.attrs.col+s[t]))).length>0&&(b="g_layer"===a[0].getParent().attrs.name?a[0].getRotationDeg():(a[0].getRotationDeg()+a[0].getParent().getRotationDeg())%360,0===h&&(n=e.getAbsolutePosition().x+k*s[t],o=e.getAbsolutePosition().y+L*i[t]),90===h&&(n=e.getAbsolutePosition().x-L*i[t],o=e.getAbsolutePosition().y+k*s[t]),180===h&&(n=e.getAbsolutePosition().x-k*s[t],o=e.getAbsolutePosition().y-L*i[t]),270===h&&(n=e.getAbsolutePosition().x+L*i[t],o=e.getAbsolutePosition().y-k*s[t]),Math.abs(n-a[0].getAbsolutePosition().x)<W&&Math.abs(o-a[0].getAbsolutePosition().y)<W&&h===b&&("g_layer"===e.getParent().attrs.name||"g_layer"===a[0].getParent().attrs.name||e.getParent()!==a[0].getParent())&&Ye(e,a[0],n,o))}function He(e){void 0!==e&&(e.setX(e.attrs.origX),e.setY(e.attrs.origY),e.setRotationDeg(0),e.moveToBottom(),e.setStrokeWidth(null),e.setStroke(null),e.setDraggable(!1),V&&e.setImage(y[e.attrs.row][e.attrs.col]),R.draw(),V&&e.disableShadow(),$&&document.getElementById("click_sound").play(),document.body.style.cursor="default",setTimeout((function(){(j+=1)===O*q&&(_e.classList.add("dn"),$&&document.getElementById("ding_sound").play())}),500))}function Ne(){Te&&localStorage.setItem("s_gold",de.checked?"on":"off"),!0===de.checked?(ee=!0,ae("img_easy").src="Images/easy_gold.svg",ae("img_med").src="Images/medium_gold.svg",ae("img_hard").src="Images/hard_gold.svg"):(ee=!1,ae("img_easy").src="Images/easy.svg",ae("img_med").src="Images/medium.svg",ae("img_hard").src="Images/hard.svg")}function Ke(){var e,n,o,a,s=0;for(e=1;e<5;e+=1)for(n=1;n<4;n+=1)o=Te&&localStorage.getItem(t+e+K+n)||0,s+=parseInt(o),te?o>0?((a=ae("medal"+e+"-"+n)).classList.remove("dn"),a.src="Images/medal"+o+".svg",n<3&&(ae("image"+e+"-"+(n+1)).classList.remove("locked"),ae("lock"+e+"-"+(n+1)).classList.add("dn"))):(ae("medal"+e+"-"+n).classList.add("dn"),n<3&&(ae("image"+e+"-"+(n+1)).classList.add("locked"),ae("lock"+e+"-"+(n+1)).classList.remove("dn"))):(ae("medal"+e+"-"+n).classList.add("dn"),ae("image"+e+"-"+(n+1)).classList.remove("locked"),ae("lock"+e+"-"+(n+1)).classList.add("dn"));36===s?(me.style.display="block",de.checked=!0,Ne(),ue.style.display="none"):(ue.style.display="block",de.checked=!1,Ne(),me.style.display="none")}function qe(){var e,o;if(g=document.documentElement.clientHeight,l=document.documentElement.clientWidth,K="",g>l&&(K="p"),navigator.onLine){for(e=1;e<H+1;e+=1)for(o=1;o<4;o+=1)ae("image"+e+"-"+o).src="Images/"+t+"/image-set-"+e+"/sujet"+K+o+"s.jpg";for(let e of document.querySelectorAll(".offline"))e.style.display="none";for(let e of document.querySelectorAll(".online"))e.style.display="block"}else{for(let e of document.querySelectorAll(".offline"))e.style.display="block";for(let e of document.querySelectorAll(".online"))e.style.display="none";E.slide(0,0)}t===n&&K===m||(n=t,m=K,Ke())}function Oe(e){var n;_e.classList.remove("dn"),e&&(n=Te&&localStorage.getItem(t+w+u+_)||0,parseInt(p)>parseInt(n)&&(Te&&localStorage.setItem(t+w+u+_,p),Ke(),$&&document.getElementById("ding_sound").play())),Ae.classList.remove("swipe-out"),Se.classList.remove("swipe-in"),Ae.classList.add("swipe-out-right"),Se.classList.add("swipe-in-left"),qe(),setTimeout((function(){qe()}),500)}function We(e){var t;e.on("mouseover",(function(){(e.getDraggable()||e.getParent().getDraggable())&&Z&&(document.body.style.cursor="pointer")})),e.on("click tap",(function(){!1!==oe&&((e.getDraggable()||e.getParent().getDraggable())&&Z&&G&&f===R.getChildren().length-1?"g_layer"===e.getParent().attrs.name?(t=e.getRotation(),Z=!1,new Kinetic.Tween({node:e,duration:.5,rotation:t+Math.PI/2,onFinish:function(){Z=!0,360===e.getRotationDeg()&&e.setRotationDeg(0),e.fire("dragend")}}).play()):(t=e.getParent().getRotation(),Z=!1,new Kinetic.Tween({node:e.getParent(),duration:.5,rotation:t+Math.PI/2,onFinish:function(){Z=!0,360===e.getParent().getRotationDeg()&&e.getParent().setRotationDeg(0),e.fire("dragend")}}).play()):j===O*q?(Z=!1,Oe(!0)):e.fire("dragend"))})),e.on("mousedown touchstart",(function(){oe=!0,setTimeout((function(){oe=!1}),500),v=e,(e.getDraggable()||e.getParent().getDraggable())&&Z&&("g_layer"===e.getParent().attrs.name?(f=e.getZIndex(),e.moveToTop()):(f=e.getParent().getZIndex(),e.getParent().moveToTop()))})),e.on("dragend",(function(){(e.getDraggable()||e.getParent().getDraggable())&&Z?function(e){var t,n,o;if(h="g_layer"===e.getParent().attrs.name?e.getRotationDeg():(e.getRotationDeg()+e.getParent().getRotationDeg())%360,Math.abs(e.getAbsolutePosition().x-e.attrs.origX)<W&&Math.abs(e.getAbsolutePosition().y-e.attrs.origY)<W&&0===h)if("g_layer"===e.getParent().attrs.name)He(e);else for(n=e.getParent().getChildren();n.length>0;)(o=n[0]).moveTo(R),He(o);else if("g_layer"===e.getParent().attrs.name)ze(e);else for(n=e.getParent().getChildren(),t=0;t<n.length;t+=1)ze(n[t])}(e):j===O*q&&(Z=!1,Oe(!0))})),e.on("mouseout",(function(){document.body.style.cursor="default"})),R.add(e),R.draw(),M.draw()}function je(e){var t;if("Safari,5.1.7"===navigator.sayswho||"MSIE,9.0"===navigator.sayswho)return Le.src="Images/photo.svg",Ee.innerHTML=document.webL10n.get("lb_own_img"),void De(ke);if((t=e.target.files[0]).type.match("image.*")){var n=new FileReader;n.onload=function(t){a=t.target.result,EXIF.getData(e.target.files[0],(function(){r=EXIF.getTag(this,"Orientation")})),ae("image0-1").src=a,ae("imageOff").src=a,qe(),setTimeout((function(){qe()}),500)},n.readAsDataURL(t)}}function Ue(e){t=e,se.src="Images/"+t+"/theme.png",B&&(ae("select_theme").innerHTML=document.webL10n.get("lb_"+t)),Te&&localStorage.setItem("s_theme",e),qe()}function Ze(){0===E.getPos()?ae("bullets0").src="Images/bullets1o.svg":ae("bullets0").src="Images/bullets0o.svg",1===E.getPos()?ae("bullets1").src="Images/bullets1.svg":ae("bullets1").src="Images/bullets0.svg",2===E.getPos()?ae("bullets2").src="Images/bullets1.svg":ae("bullets2").src="Images/bullets0.svg",3===E.getPos()?ae("bullets3").src="Images/bullets1.svg":ae("bullets3").src="Images/bullets0.svg",4===E.getPos()?ae("bullets4").src="Images/bullets1.svg":ae("bullets4").src="Images/bullets0.svg"}function Ge(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null!==t&&t[1]}"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("sw.js").then((function(e){}),(function(e){}))})),ce.addEventListener("mouseup",(function(){void 0!==v&&"g_layer"!==v.getParent().attrs.name&&setTimeout((function(){v.fire("dragend")}),350)}),!1),ce.addEventListener("touchend",(function(){void 0!==v&&"g_layer"!==v.getParent().attrs.name&&setTimeout((function(){v.fire("dragend")}),350)}),!1),Array.from(document.getElementsByClassName("own-nav")).forEach((function(e){e.addEventListener("click",(function(){if("Safari,5.1.7"===navigator.sayswho||"MSIE,9.0"===navigator.sayswho)return Le.src="Images/photo.svg",Ee.innerHTML=document.webL10n.get("lb_own_img"),void De(ke);"file"!==we.type?window.MozActivity&&(new MozActivity({name:"pick",data:{type:"image/jpeg"}}).onsuccess=function(){a=window.URL.createObjectURL(this.result.blob),ae("image0-1").src=a,ae("imageOff").src=a,qe(),setTimeout((function(){qe()}),500)}):we.click()}))})),window.onload=function(){ne&&(ne=!1,ae("iInfo").addEventListener("click",(function(){De(pe)})),ae("iInfoClose").addEventListener("click",(function(){xe(pe)})),ae("iSettings").addEventListener("click",(function(){z||(z=!0,ae("t_europe").src="Images/europe/theme.png",ae("t_africa").src="Images/africa/theme.png",ae("t_asia").src="Images/asia/theme.png",ae("t_america").src="Images/america/theme.png",ae("t_animals").src="Images/animals/theme.png",ae("t_flowers").src="Images/flowers/theme.png",ae("t_tricky").src="Images/tricky/theme.png",ae("t_mascha").src="Images/mascha/theme.png",ae("t_mascha2").src="Images/mascha2/theme.png",ae("t_mascha3").src="Images/mascha3/theme.png",ae("t_shrek").src="Images/shrek/theme.png"),De(Pe)})),ae("iSettingsClose").addEventListener("click",(function(){xe(Pe)})),Ie.addEventListener("click",(function(){var e,t,n,o;e=window.document,t=e.documentElement,n=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,o=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen,e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?o.call(e):n.call(t)})),(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)||!0===navigator.standalone||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&Ie.parentNode.removeChild(Ie),ae("iCloseHelp").addEventListener("click",(function(){xe(ke)})),ke.addEventListener("click",(function(){ae("iCloseHelp").classList.contains("dn")||xe(ke)})),ae("bt_theme").addEventListener("click",(function(){document.getElementsByClassName("dropdown")[0].classList.toggle("show"),document.getElementsByClassName("icon")[0].classList.toggle("rotate")})),de.addEventListener("change",e=>{Ne()}),E=new Swipe(document.getElementById("image_slider"),{startSlide:1,callback:function(e,t){ae("bullets0").src=0===t?"Images/bullets1o.svg":"Images/bullets0o.svg",1===t?ae("bullets1").src="Images/bullets1.svg":(ae("bullets1").src="Images/bullets0.svg",H=4,qe()),ae("bullets2").src=2===t?"Images/bullets1.svg":"Images/bullets0.svg",ae("bullets3").src=3===t?"Images/bullets1.svg":"Images/bullets0.svg",ae("bullets4").src=4===t?"Images/bullets1.svg":"Images/bullets0.svg"}}),document.getElementById("b_image_input").addEventListener("change",je,!1),Array.from(document.getElementsByClassName("list-button-33-sel")).forEach((function(e){e.addEventListener("click",(function(){event,Array.from(event.target.parentNode.getElementsByClassName("list-button-33-sel")).forEach((function(e){e.classList.remove("selected")})),event.target.classList.add("selected")}))})),fe.addEventListener("click",(function(e){E.prev(),Ze(),e.preventDefault()})),he.addEventListener("click",(function(e){E.next(),Ze(),e.preventDefault()})),be.addEventListener("click",(function(){p="1",g>l?ee?(q=9,O=6):(q=3,O=2):ee?(q=6,O=9):(q=2,O=3),Xe()})),ve.addEventListener("click",(function(){p="2",g>l?ee?(q=12,O=8):(q=6,O=4):ee?(q=8,O=12):(q=4,O=6),Xe()})),ye.addEventListener("click",(function(){p="3",g>l?ee?(q=18,O=12):(q=8,O=5):ee?(q=12,O=18):(q=5,O=8),Xe()})),_e.addEventListener("click",(function(){Z=!1,Oe(!1)})),ae("s_mascha").addEventListener("click",(function(){(X+=1)>2&&(Array.from(document.getElementsByClassName("t_mascha")).forEach((function(e){e.classList.remove("dn")})),Te&&localStorage.setItem("s_mascha","true"))})),ae("s_grrd").addEventListener("click",(function(){(Y+=1)>5&&(ae("t_shrek").parentNode.classList.remove("dn"),ae("favicon").href="Images/favicon_dark.ico",Te&&localStorage.setItem("s_shrek","true"))})),Array.from(document.getElementsByClassName("dropdown"))[0].childNodes.forEach((function(e){e.addEventListener("click",(function(){Ue(e.getElementsByTagName("img")[0].getAttribute("alt")),document.getElementsByClassName("dropdown")[0].classList.remove("show"),document.getElementsByClassName("icon")[0].classList.remove("rotate")}))})),Te?(null===localStorage.getItem("s_back_g_grid")?ie.checked=!0:ie.checked="on"===localStorage.getItem("s_back_g_grid"),null===localStorage.getItem("s_backg_image")?re.checked=!0:re.checked="on"===localStorage.getItem("s_backg_image"),null===localStorage.getItem("s_rotate")?le.checked=!1:le.checked="on"===localStorage.getItem("s_rotate"),null===localStorage.getItem("s_sound")?ge.checked=!0:ge.checked="on"===localStorage.getItem("s_sound"),null===localStorage.getItem("s_gold")?(de.checked=!1,Ne()):(de.checked="on"===localStorage.getItem("s_gold"),Ne()),null===localStorage.getItem("s_theme")?Ue("animals"):Ue(localStorage.getItem("s_theme"))):(ie.checked=!0,re.checked=!0,le.checked=!1,ge.checked=!0,de.checked=!1,Ne(),Ue("animals")),("true"===(e=Ge("mascha"))||Te&&"true"===localStorage.getItem("s_mascha"))&&(Array.from(document.getElementsByClassName("t_mascha")).forEach((function(e){e.classList.remove("dn")})),Te&&localStorage.setItem("s_mascha","true")),("true"===(e=Ge("shrek"))||Te&&"true"===localStorage.getItem("s_shrek"))&&(ae("t_shrek").parentNode.classList.remove("dn"),ae("favicon").href="Images/favicon_dark.ico",Te&&localStorage.setItem("s_shrek","true")),(e=Ge("theme"))&&Ue(e),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(fe.style.display="none",he.style.display="none"),qe(),setTimeout((function(){qe()}),500))},window.addEventListener("resize",(function(){qe()})),document.addEventListener("fullscreenchange",(function(){Re()})),document.addEventListener("mozfullscreenchange",(function(){Re()})),document.addEventListener("webkitfullscreenchange",(function(){Re()})),document.addEventListener("msfullscreenchange",(function(){Re()})),navigator.sayswho=(S=navigator.appName,A=navigator.userAgent,T=A.match(/version\/([.\d]+)/i),(D=A.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i))&&null!==T&&(D[2]=T[1]),D=D?[D[1],D[2]]:[S,navigator.appVersion,"-?"]),document.webL10n.ready((function(){B=!0,(e=Ge("lang"))&&e!==document.webL10n.getLanguage()&&(document.webL10n.setLanguage(e),B=!1)})),document.addEventListener("localized",(function(){B&&(document.documentElement.lang=document.webL10n.getLanguage().substr(0,2),document.querySelector("meta[name='description']").setAttribute("content",document.webL10n.get("lb_desc")),document.querySelector("link[rel='manifest']").href="Manifest/appmanifest_"+document.webL10n.getLanguage().substr(0,2)+".json",document.querySelector("link[rel='canonical']")&&(document.querySelector("link[rel='canonical']").href="https://grrd01.github.io/Puzzle/?lang="+document.webL10n.getLanguage().substr(0,2)),ae("select_theme").innerHTML=document.webL10n.get("lb_"+t),ae("imageOff").setAttribute("alt",document.webL10n.get("lb_image")),ae("image0-1").setAttribute("alt",document.webL10n.get("lb_image")),x||(Le.src="Images/piece_gold.svg",Ee.innerHTML=document.webL10n.get("lb_html5"),De(ke)),setTimeout((function(){new Date("05/01/2020")>new Date&&"africa"!==t&&Te&&"africa"!==localStorage.getItem("s_new_theme")&&(Le.src="Images/africa/theme.png",Ee.innerHTML=document.webL10n.get("lb_new_theme")+" "+document.webL10n.get("lb_africa"),De(ke),localStorage.setItem("s_new_theme","africa"))}),500)),B=!0}))}();