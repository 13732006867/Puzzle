/*
* grrd's Puzzle
* Copyright (c) 2012 Gerard Tyedmers, grrd@gmx.net
* Licensed under the MPL License
*/
!function(){"use strict";function a(a,b){var c,d=document.createElement("canvas");d.width=1,d.height=b;var e=d.getContext("2d");e.drawImage(a,0,0);for(var f=e.getImageData(0,0,1,b).data,g=0,h=b,i=b;i>g;)c=f[4*(i-1)+3],0===c?h=i:g=i,i=h+g>>1;var j=i/b;return 0===j?1:j}function b(a){var b,c,d,e;if(ha&&(b=new Kinetic.Image({x:0,y:0,width:F,height:G,Image:a,opacity:.1}),S.add(b),S.draw()),ga)for(c=0;Y>c;c+=1)for(d=0;Z>d;d+=1)e=new Kinetic.Rect({x:d*O,y:c*P,width:O,height:P,stroke:"#333333",strokeWidth:2}),S.add(e);T.add(S),S.moveToBottom()}function c(){ca=!0,ba=!1}function d(){var a,b;$.mobile.hidePageLoadingMsg(),$.mobile.changePage("#game",{transition:"slide"}),setTimeout(function(){var d=R.getChildren();for(b=0;b<d.length;b+=1)d[b].setZIndex(Math.floor(Math.random()*Z*Y));for(b=0;b<d.length;b+=1)da?(a=new Kinetic.Tween({node:d[b],x:Math.floor(Math.random()*O*(Z-1))+O/2,y:Math.floor(Math.random()*P*(Y-1))+P/2,rotation:.5*Math.PI*Math.floor(4*Math.random()),duration:1,onFinish:c()}),a.play()):(a=new Kinetic.Tween({node:d[b],x:Math.floor(Math.random()*O*(Z-1))+O/2,y:Math.floor(Math.random()*P*(Y-1))+P/2,duration:1,onFinish:c()}),a.play())},2e3)}function e(a,b,c,d){!function(){var e;if(fa){var f=new Kinetic.Shape({drawFunc:function(d){d.beginPath(),d.moveTo(M,N),0===b?d.lineTo(M+O,N):(d.bezierCurveTo(M+.8*O,N+.1*P*c,M,N-.25*P*c,M+O/2,N-.25*P*c),d.bezierCurveTo(M+O,N-.25*P*c,M+.2*O,N+.1*P*c,M+O,N)),a===Z-1?d.lineTo(M+O,N+P):(d.bezierCurveTo(M+O+.1*O*c,N+.8*P,M+O-.25*O*c,N,M+O-.25*O*c,N+P/2),d.bezierCurveTo(M+O-.25*O*c,N+P,M+O+.1*O*c,N+.2*P,M+O,N+P)),b===Y-1?d.lineTo(M,N+P):(d.bezierCurveTo(M+.2*O,N+P-.1*P*c,M+O,N+P+.25*P*c,M+O/2,N+P+.25*P*c),d.bezierCurveTo(M,N+P+.25*P*c,M+.8*O,N+P-.1*P*c,M,N+P)),0===a?d.lineTo(M,N):(d.bezierCurveTo(M-.1*O*c,N+.2*P,M+.25*O*c,N+P,M+.25*O*c,N+P/2),d.bezierCurveTo(M+.25*O*c,N,M-.1*O*c,N+.8*P,M,N)),d.closePath(),d.fillStrokeShape(this)},fillPatternImage:d,fillPatternOffset:[a*O,b*P],stroke:"black",strokeWidth:4});f.toImage({width:O+.6*O,height:P+.6*P,x:.3*-O,y:.3*-P,callback:function(c){e=new Kinetic.Image({image:c,x:a*O+O/2,origX:a*O+O/2,y:b*P+P/2,origY:b*P+P/2,row:b,col:a,offset:[O/2+.3*O,P/2+.3*P],draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>F&&(c=F),0>b&&(b=0),b>G&&(b=G),{x:c,y:b}},name:"part_z"+b+"_s"+a}),q(e),e.createImageHitRegion(function(){R.drawHit()})}}),f.setStrokeWidth(null),f.setStroke(null),f.toImage({width:O+.6*O,height:P+.6*P,x:.3*-O,y:.3*-P,callback:function(c){L[b][a]=c}})}else e=new Kinetic.Image({x:a*O+O/2,origX:a*O+O/2,y:b*P+P/2,origY:b*P+P/2,row:b,col:a,width:O,height:P,offset:[O/2,P/2],crop:{x:d.width/Z*a,y:d.height/Y*b,width:d.width/Z,height:d.height/Y},stroke:"black",strokeWidth:4,fill:"black",Image:d,draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>F&&(c=F),0>b&&(b=0),b>G&&(b=G),{x:c,y:b}},name:"part_z"+b+"_s"+a}),q(e)}()}function f(){var c,f;for(L=[],c=0;Y>c;c+=1)L[c]=[];aa=0,R.removeChildren(),S.removeChildren(),T.removeChildren(),T.setWidth(F),T.setHeight(G),M=0,N=0,O=F/Z,P=G/Y,Ca=1,T.add(R);var g=F,h=G;if(U){var i=a(W,W.naturalHeight);h/=i}(5===C||6===C||7===C||8===C)&&(g=G,h=F);var j=new Kinetic.Image({width:g,height:h,crop:{x:0,y:0,width:W.width,height:W.height},Image:W});0!==Q.getPos()||5!==C&&6!==C||(j.setRotationDeg(90),j.setX(F)),0!==Q.getPos()||3!==C&&4!==C||(j.setRotationDeg(180),j.setX(F),j.setY(G)),0!==Q.getPos()||7!==C&&8!==C||(j.setRotationDeg(270),j.setY(G)),j.toImage({width:F,height:G,callback:function(a){if((ga||ha)&&b(a),fa)j.toImage({width:F,height:G,callback:function(a){for(f=0;Y>f;f+=1)for(c=0;Z>c;c+=1)Ca=f%2!==0&&c%2!==0||f%2===0&&c%2===0?1:-1,e(c,f,Ca,a);R.draw(),d()}});else{for(f=0;Y>f;f+=1)for(c=0;Z>c;c+=1)Ca=f%2!==0&&c%2!==0||f%2===0&&c%2===0?1:-1,e(c,f,Ca,a);R.draw(),d()}}})}function g(){var a=$("input:radio[name=image-set-"+Q.getPos()+"]:checked").val();if(!ba){if(void 0===a)return void alert(navigator.mozL10n.get("lb_choose"));if(void 0===B&&0===Q.getPos())return void alert(navigator.mozL10n.get("lb_choose"));ba=!0,$.mobile.showPageLoadingMsg("a",navigator.mozL10n.get("lb_load"),!1),ga="on"===na.val(),ha="on"===oa.val(),da="on"===pa.val(),ia="on"===qa.val(),navigator.sayswho.indexOf("MSIE")<0&&(localStorage.setItem("s_backg_grid",na.val()),localStorage.setItem("s_backg_image",oa.val()),localStorage.setItem("s_rotate",pa.val()),localStorage.setItem("s_sound",qa.val())),document.getElementById("container").width=D,document.getElementById("container").height=E,G=E-4,F=D,A=0!==Q.getPos()?"Images/"+z+"/image-set-"+Q.getPos()+"/sujet"+X+a+".jpg":B,$("#g_imageObj").one("load",function(){W=document.getElementById("g_imageObj"),f()}).attr("src",A).each(function(){navigator.sayswho.indexOf("MSIE")>=0&&this.complete&&$(this).trigger("load")})}}function h(){E>D?ja?(Y=9,Z=6):(Y=3,Z=2):ja?(Y=6,Z=9):(Y=2,Z=3),g()}function i(){E>D?ja?(Y=12,Z=8):(Y=6,Z=4):ja?(Y=8,Z=12):(Y=4,Z=6),g()}function j(){E>D?ja?(Y=18,Z=12):(Y=8,Z=5):ja?(Y=12,Z=18):(Y=5,Z=8),g()}function k(a,b,c,d){var e,f,g,h,i,j,k;if("g_layer"===a.getParent().attrs.name)if("g_layer"===b.getParent().attrs.name){b.setX(c),b.setY(d);var l=new Kinetic.Group({draggable:!0,dragBoundFunc:function(a){var b=a.y,c=a.x;return 0>c&&(c=0),c>F&&(c=F),0>b&&(b=0),b>G&&(b=G),{x:c,y:b}},name:"gruppe"});a.moveTo(l),b.moveTo(l),a.setDraggable(!1),b.setDraggable(!1),R.add(l)}else h=a.getX(),i=a.getY(),b.getParent().setX(b.getParent().getX()+c-b.getAbsolutePosition().x),b.getParent().setY(b.getParent().getY()+d-b.getAbsolutePosition().y),a.moveTo(b.getParent()),a.setRotationDeg(b.getRotationDeg()),j=h-a.getAbsolutePosition().x,k=i-a.getAbsolutePosition().y,0===a.getParent().getRotationDeg()&&(a.setX(a.getX()+j),a.setY(a.getY()+k)),90===a.getParent().getRotationDeg()&&(a.setY(a.getY()-j),a.setX(a.getX()+k)),180===a.getParent().getRotationDeg()&&(a.setX(a.getX()-j),a.setY(a.getY()-k)),270===a.getParent().getRotationDeg()&&(a.setY(a.getY()+j),a.setX(a.getX()-k)),a.setDraggable(!1);else if("g_layer"===b.getParent().attrs.name)b.moveTo(a.getParent()),b.setAbsolutePosition(c,d),b.setRotationDeg(a.getRotationDeg()),b.setDraggable(!1);else{f=b.getParent().getChildren();for(var m=c-b.getAbsolutePosition().x,n=d-b.getAbsolutePosition().y;f.length>0;)void 0!==f[0]&&(g=f[0],h=g.getAbsolutePosition().x,i=g.getAbsolutePosition().y,g.moveTo(a.getParent()),g.setRotationDeg(a.getRotationDeg()),j=h-g.getAbsolutePosition().x+m,k=i-g.getAbsolutePosition().y+n,0===a.getParent().getRotationDeg()&&(g.setX(g.getX()+j),g.setY(g.getY()+k)),90===a.getParent().getRotationDeg()&&(g.setY(g.getY()-j),g.setX(g.getX()+k)),180===a.getParent().getRotationDeg()&&(g.setX(g.getX()-j),g.setY(g.getY()-k)),270===a.getParent().getRotationDeg()&&(g.setY(g.getY()+j),g.setX(g.getX()-k)))}f=a.getParent().getChildren();var o=f[0].getAbsolutePosition().x,p=f[0].getAbsolutePosition().x,q=f[0].getAbsolutePosition().y,r=f[0].getAbsolutePosition().y;for(e=0;e<f.length;e+=1)f[e].getAbsolutePosition().x<o&&(o=f[e].getAbsolutePosition().x),f[e].getAbsolutePosition().x>p&&(p=f[e].getAbsolutePosition().x),f[e].getAbsolutePosition().y<q&&(q=f[e].getAbsolutePosition().y),f[e].getAbsolutePosition().y>r&&(r=f[e].getAbsolutePosition().y);h=a.getAbsolutePosition().x,i=a.getAbsolutePosition().y,a.getParent().setOffset(0,0),a.getParent().setX((o+p)/2),a.getParent().setY((q+r)/2),j=h-a.getAbsolutePosition().x,k=i-a.getAbsolutePosition().y,0===a.getParent().getRotationDeg()&&a.getParent().setOffset(-1*j,-1*k),90===a.getParent().getRotationDeg()&&a.getParent().setOffset(-1*k,j),180===a.getParent().getRotationDeg()&&a.getParent().setOffset(j,k),270===a.getParent().getRotationDeg()&&a.getParent().setOffset(k,-1*j),"g_layer"===b.getParent().attrs.name?b.moveToTop():b.getParent().moveToTop(),R.draw(),ia&&document.getElementById("click_sound").play()}function l(a){var b,c,d,e,f=[-1,1,0,0],g=[0,0,-1,1];for(I="g_layer"===a.getParent().attrs.name?a.getRotationDeg():(a.getRotationDeg()+a.getParent().getRotationDeg())%360,b=0;b<f.length;b+=1)e=T.get(".part_z"+(a.attrs.row+g[b])+"_s"+(a.attrs.col+f[b])),e.length>0&&(J="g_layer"===e[0].getParent().attrs.name?e[0].getRotationDeg():(e[0].getRotationDeg()+e[0].getParent().getRotationDeg())%360,0===I&&(c=a.getAbsolutePosition().x+O*f[b],d=a.getAbsolutePosition().y+P*g[b]),90===I&&(c=a.getAbsolutePosition().x-P*g[b],d=a.getAbsolutePosition().y+O*f[b]),180===I&&(c=a.getAbsolutePosition().x-O*f[b],d=a.getAbsolutePosition().y-P*g[b]),270===I&&(c=a.getAbsolutePosition().x+P*g[b],d=a.getAbsolutePosition().y-O*f[b]),Math.abs(c-e[0].getAbsolutePosition().x)<_&&Math.abs(d-e[0].getAbsolutePosition().y)<_&&I===J&&("g_layer"===a.getParent().attrs.name||"g_layer"===e[0].getParent().attrs.name||a.getParent()!==e[0].getParent())&&k(a,e[0],c,d))}function m(a){void 0!==a&&(a.setX(a.attrs.origX),a.setY(a.attrs.origY),a.setRotationDeg(0),a.moveToBottom(),a.setStrokeWidth(null),a.setStroke(null),a.setDraggable(!1),fa&&a.setImage(L[a.attrs.row][a.attrs.col]),R.draw(),(ea||fa)&&a.disableShadow(),ia&&document.getElementById("click_sound").play(),document.body.style.cursor="default",setTimeout(function(){aa+=1,aa===Z*Y&&(ya.css("display","none"),ia&&document.getElementById("ding_sound").play())},500))}function n(a){var b,c,d;if(I="g_layer"===a.getParent().attrs.name?a.getRotationDeg():(a.getRotationDeg()+a.getParent().getRotationDeg())%360,Math.abs(a.getAbsolutePosition().x-a.attrs.origX)<_&&Math.abs(a.getAbsolutePosition().y-a.attrs.origY)<_&&0===I)if("g_layer"===a.getParent().attrs.name)m(a);else for(c=a.getParent().getChildren();c.length>0;)d=c[0],d.moveTo(R),m(d);else if("g_layer"===a.getParent().attrs.name)l(a);else for(c=a.getParent().getChildren(),b=0;b<c.length;b+=1)l(c[b])}function o(){var a,b;for(E=$(window).height(),D=$(window).width(),X="",E>D?(X="p",$("#img_title").attr("style","width:100%;"),$("#image0").attr("style","height:"+1.5*(D/3-50)+"px;")):($("#img_title").attr("style","max-height:"+E/5+"px;"),$("#image0").attr("style","height:"+(D/3-50)/1.5+"px;")),Aa.css("max-height",E-10+"px"),Ba.css("max-width",D-10+"px"),va.attr("style","width:"+(D/3-12)+"px;"),wa.attr("style","width:"+(D/3-12)+"px;"),xa.attr("style","width:"+(D/3-12)+"px;"),a=1;5>a;a+=1)for(b=1;4>b;b+=1)$("#radio"+a+"-"+b).attr("style","width:"+(D/3-12)+"px;"),$("#image"+a+"-"+b).attr("src","Images/"+z+"/image-set-"+a+"/sujet"+X+b+"s.jpg")}function p(){ya.css("display","inline"),$.mobile.changePage("#title",{transition:"slide",reverse:!0}),o(),setTimeout(function(){o()},500)}function q(a){var b,c,d,e=null;ea&&a.enableShadow(),a.on("mouseover",function(){(a.getDraggable()||a.getParent().getDraggable())&&ca&&(document.body.style.cursor="pointer")}),a.on("click tap",function(){la!==!1&&((a.getDraggable()||a.getParent().getDraggable())&&ca&&da&&H===R.getChildren().length-1?"g_layer"===a.getParent().attrs.name?(c=a.getRotation(),ca=!1,d=new Kinetic.Tween({node:a,duration:.5,rotation:c+Math.PI/2,onFinish:function(){ca=!0,360===a.getRotationDeg()&&a.setRotationDeg(0),a.fire("dragend")}}),d.play()):(c=a.getParent().getRotation(),ca=!1,d=new Kinetic.Tween({node:a.getParent(),duration:.5,rotation:c+Math.PI/2,onFinish:function(){ca=!0,360===a.getParent().getRotationDeg()&&a.getParent().setRotationDeg(0),a.fire("dragend")}}),d.play()):aa===Z*Y?(ca=!1,p()):a.fire("dragend"))}),a.on("mousedown touchstart",function(){la=!0,setTimeout(function(){la=!1},500),K=a,(a.getDraggable()||a.getParent().getDraggable())&&ca&&("g_layer"===a.getParent().attrs.name?(H=a.getZIndex(),a.moveToTop(),ea&&(e&&e.stop(),a.setAttrs({scale:{x:1.05,y:1.05}}))):(H=a.getParent().getZIndex(),a.getParent().moveToTop(),ea&&(e&&e.stop(),a.getParent().setAttrs({scale:{x:1.05,y:1.05}}),b=a.getParent().getChildren())))}),a.on("dragend",function(){(a.getDraggable()||a.getParent().getDraggable())&&ca?ea&&"g_layer"===a.getParent().attrs.name?(d=new Kinetic.Tween({node:a,duration:.5,easing:Kinetic.Easings.ElasticEaseOut,scaleX:1,scaleY:1,shadowOffsetX:5,shadowOffsetY:5,onFinish:n(a)}),d.play()):ea&&"g_layer"!==a.getParent().attrs.name?(d=new Kinetic.Tween({node:a.getParent(),duration:.5,easing:Kinetic.Easings.ElasticEaseOut,scaleX:1,scaleY:1,onFinish:n(a)}),d.play(),b=a.getParent().getChildren()):n(a):aa===Z*Y&&(ca=!1,p())}),a.on("mouseout",function(){document.body.style.cursor="default"}),R.add(a),R.draw(),T.draw()}function r(a){var b;if("Safari,5.1.7"===navigator.sayswho||"MSIE,9.0"===navigator.sayswho)return void alert(navigator.mozL10n.get("lb_own_img"));if(b=a.target.files[0],b.type.match("image.*")){var c=new FileReader;c.onload=function(){return function(a){B=a.target.result;var b=atob(B.split(",")[1]),c=EXIF.readFromBinaryFile(new BinaryFile(b));C=c.Orientation,$("#image0").attr("src",B),o(),setTimeout(function(){o()},500)}}(b),c.readAsDataURL(b)}}function s(a){z=a,ma.attr("src","Images/"+z+"/theme.png"),V&&$("#select_theme").html(navigator.mozL10n.get("lb_"+z)),navigator.sayswho.indexOf("MSIE")<0&&localStorage.setItem("s_theme",a),ma.attr("style","width:59px; float:left;"),o(),ma.attr("style","width:60px; float:left;")}function t(a){sa.val(a),localStorage.setItem("s_gold",sa.val()),"on"===sa.val()?(ja=!0,$("#img_easy").attr("src","Images/easy_gold.png"),$("#img_med").attr("src","Images/medium_gold.png"),$("#img_hard").attr("src","Images/hard_gold.png")):(ja=!1,$("#img_easy").attr("src","Images/easy.png"),$("#img_med").attr("src","Images/medium.png"),$("#img_hard").attr("src","Images/hard.png"))}function u(){0===Q.getPos()?$("#bullets0").attr("src","Images/bullets1o.png"):$("#bullets0").attr("src","Images/bullets0o.png"),1===Q.getPos()?$("#bullets1").attr("src","Images/bullets1.png"):$("#bullets1").attr("src","Images/bullets0.png"),2===Q.getPos()?$("#bullets2").attr("src","Images/bullets1.png"):$("#bullets2").attr("src","Images/bullets0.png"),3===Q.getPos()?$("#bullets3").attr("src","Images/bullets1.png"):$("#bullets3").attr("src","Images/bullets0.png"),4===Q.getPos()?$("#bullets4").attr("src","Images/bullets1.png"):$("#bullets4").attr("src","Images/bullets0.png")}function v(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return null!==d?d[1]:!1}function w(){new Date("10/25/2014")>new Date&&"flowers"!==z&&"flowers"!==localStorage.getItem("s_new_theme")&&(Ba.popup("open"),o(),setTimeout(function(){o()},500))}var x=!!window.HTMLCanvasElement;x||alert("Your browser does not support HTML5. Please use a modern browser like Chrome or Firefox.");var y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R=new Kinetic.Layer({name:"g_layer"}),S=new Kinetic.Layer({name:"g_back_g_layer"}),T=new Kinetic.Stage({container:"container",width:document.getElementById("container").width,height:document.getElementById("container").height}),U=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,V=!1,W=new Image,X="",Y=4,Z=6,_=15,aa=0,ba=!1,ca=!1,da=!1,ea=!1,fa=!0,ga=!0,ha=!0,ia=!0,ja=!1,ka=!0,la=!1,ma=$("#select_theme_img"),na=$("#b_back_g_grid"),oa=$("#b_back_g_image"),pa=$("#b_rotate"),qa=$("#b_sound"),ra=$("#container"),sa=$("#b_gold"),ta=$("#b_prev"),ua=$("#b_next"),va=$("#bt_easy"),wa=$("#bt_med"),xa=$("#bt_hard"),ya=$("#bt_close"),za=$("#b_image_input"),Aa=$("#popupTheme"),Ba=$("#popupNewTheme"),Ca=1;ra.mouseup(function(){void 0!==K&&"g_layer"!==K.getParent().attrs.name&&setTimeout(function(){K.fire("dragend")},350)}),ra.touchend(function(){void 0!==K&&"g_layer"!==K.getParent().attrs.name&&setTimeout(function(){K.fire("dragend")},350)}),$("#image-set-0").click(function(){if("Safari,5.1.7"===navigator.sayswho||"MSIE,9.0"===navigator.sayswho)return void alert(navigator.mozL10n.get("lb_own_img"));if("file"!==za.attr("type")){if(window.MozActivity){var a=new MozActivity({name:"pick",data:{type:"image/jpeg"}});a.onsuccess=function(){B=window.URL.createObjectURL(this.result.blob),$("#image0").attr("src",B),o(),setTimeout(function(){o()},500)}}}else za.click()}).show(),sa.on("change",function(){t(sa.val())}),window.onload=function(){ka&&(ka=!1,Q=new Swipe(document.getElementById("image_slider"),{startSlide:1,callback:function(a,b){0===b?$("#bullets0").attr("src","Images/bullets1o.png"):$("#bullets0").attr("src","Images/bullets0o.png"),1===b?$("#bullets1").attr("src","Images/bullets1.png"):$("#bullets1").attr("src","Images/bullets0.png"),2===b?$("#bullets2").attr("src","Images/bullets1.png"):$("#bullets2").attr("src","Images/bullets0.png"),3===b?$("#bullets3").attr("src","Images/bullets1.png"):$("#bullets3").attr("src","Images/bullets0.png"),4===b?$("#bullets4").attr("src","Images/bullets1.png"):$("#bullets4").attr("src","Images/bullets0.png")}}),document.getElementById("b_image_input").addEventListener("change",r,!1),ta.click(function(a){Q.prev(),u(),a.preventDefault()}),ua.click(function(a){Q.next(),u(),a.preventDefault()}),va.click(function(a){h(),a.preventDefault()}),wa.click(function(a){i(),a.preventDefault()}),xa.click(function(a){j(),a.preventDefault()}),ya.click(function(a){ca=!1,p(),a.preventDefault()}),Ba.click(function(a){s("flowers"),$("#popupNewTheme").popup("close"),a.preventDefault()}),Aa.find("a").click(function(a){s(this.children[0].getAttribute("alt")),Aa.popup("close"),a.preventDefault()}),Aa.css({"overflow-y":"auto","min-width":"270px"}),navigator.sayswho.indexOf("MSIE")>=0?(na.val("on"),oa.val("on"),pa.val("off"),qa.val("on"),t("off")):(null===localStorage.getItem("s_backg_grid")?na.val("on"):na.val(localStorage.getItem("s_backg_grid")),null===localStorage.getItem("s_backg_image")?oa.val("on"):oa.val(localStorage.getItem("s_backg_image")),null===localStorage.getItem("s_rotate")?pa.val("off"):pa.val(localStorage.getItem("s_rotate")),null===localStorage.getItem("s_sound")?qa.val("on"):qa.val(localStorage.getItem("s_sound")),t(null===localStorage.getItem("s_gold")?"off":localStorage.getItem("s_gold")),s(null===localStorage.getItem("s_theme")?"animals":localStorage.getItem("s_theme"))),y=v("theme"),y&&s(y),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&(ta.attr("style","display:none;"),ua.attr("style","display:none;")),/Android/i.test(navigator.userAgent)||(za.attr("style","display:none;"),$("#b_tit_image_input").attr("style","display:none;")),$("#popupSettings").find("label").attr("style","display:inline;"),o(),setTimeout(function(){o()},500))},$(window).resize(function(){o()}),navigator.sayswho=function(){var a,b=navigator.appName,c=navigator.userAgent,d=c.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return d&&null!=(a=c.match(/version\/([\.\d]+)/i))&&(d[2]=a[1]),d=d?[d[1],d[2]]:[b,navigator.appVersion,"-?"]}(),navigator.mozL10n.ready(function(){V=!0,y=v("lang"),y&&y!==navigator.mozL10n.language.code&&(navigator.mozL10n.language.code=y),$("#select_theme").html(navigator.mozL10n.get("lb_"+z)),setTimeout(function(){w()},500)})}();